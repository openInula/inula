{"version":3,"file":"vradapter.min.js","sources":["../../src/history/dom.ts","../../src/history/types.ts","../../../../node_modules/.pnpm/@babel+runtime@7.23.8/node_modules/@babel/runtime/helpers/esm/extends.js","../../src/history/utils.ts","../../../../node_modules/.pnpm/@babel+runtime@7.23.8/node_modules/@babel/runtime/helpers/esm/typeof.js","../../../../node_modules/.pnpm/@babel+runtime@7.23.8/node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","../../../../node_modules/.pnpm/@babel+runtime@7.23.8/node_modules/@babel/runtime/helpers/esm/toPrimitive.js","../../../../node_modules/.pnpm/@babel+runtime@7.23.8/node_modules/@babel/runtime/helpers/esm/createClass.js","../../src/history/transitionManager.ts","../../../../node_modules/.pnpm/@babel+runtime@7.23.8/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../../src/history/waring.ts","../../src/history/browerHistory.ts","../../src/history/baseHistory.ts","../../src/vue-router-adapter/utils.ts","../../src/vue-router-adapter/vueHistory.ts","../../src/vue-router-adapter/const.ts","../../src/vue-router-adapter/RouterContext.ts","../../src/matcher/types.ts","../../src/matcher/utils.ts","../../src/matcher/lexer.ts","../../src/matcher/parser.ts","../../src/matcher/matcher.ts","../../src/vue-router-adapter/routerError.ts","../../../../node_modules/.pnpm/@babel+runtime@7.23.8/node_modules/@babel/runtime/helpers/esm/defineProperty.js","../../src/vue-router-adapter/hooks.ts","../../src/vue-router-adapter/RouterLink.tsx","../../src/vue-router-adapter/RouterView.tsx","../../src/vue-router-adapter/Router.ts","../../src/vue-router-adapter/RouterProvider.tsx","../../src/vue-router-adapter/componentGuards.ts"],"sourcesContent":["export function isBrowser(): boolean {\r\n  return typeof window !== 'undefined' && window.document && typeof window.document.createElement === 'function';\r\n}\r\n\r\nexport function getDefaultConfirmation(message: string, callBack: (result: boolean) => void) {\r\n  callBack(window.confirm(message));\r\n}\r\n\r\n// 判断浏览器是否支持pushState方法，pushState是browserHistory实现的基础\r\nexport function isSupportHistory(): boolean {\r\n  return isBrowser() && window.history && 'pushState' in window.history;\r\n}\r\n\r\n// 判断浏览器是否支持PopState事件\r\nexport function isSupportsPopState(): boolean {\r\n  return window.navigator.userAgent.indexOf('Trident') === -1;\r\n}\r\n","export type BaseOption = {\r\n  basename?: string;\r\n  getUserConfirmation?: ConfirmationFunc;\r\n};\r\n\r\nexport interface HistoryProps<T = unknown> {\r\n  readonly action: Action;\r\n\r\n  readonly location: Location<T>;\r\n\r\n  length: number;\r\n}\r\n\r\nexport interface AgnosticHistory<T = unknown> extends HistoryProps<T> {\r\n  createHref(path: Partial<Path>): string;\r\n\r\n  push(to: To, state?: T): void;\r\n\r\n  replace(to: To, state?: T): void;\r\n\r\n  listen(listener: CommonListener<T>): () => void;\r\n\r\n  // add listener for listen pop action\r\n  addListener(listener: Listener<T>): () => void;\r\n\r\n  // cancel all pop listeners\r\n  destroy(): void;\r\n\r\n  block(prompt: Prompt<T>): () => void;\r\n\r\n  go(index: number): void;\r\n\r\n  goBack(): void;\r\n\r\n  goForward(): void;\r\n}\r\n\r\nexport type History<T = unknown> = Omit<AgnosticHistory<T>, 'addListener' | 'destroy'>;\r\n\r\nexport interface LocationHandler<T> {\r\n  locationHandler?: ((state?: Partial<HistoryState<T>>) => Location<T>) | null;\r\n  baseHandler?: (() => string) | null;\r\n}\r\n\r\nexport interface CreateLocationHandler<T> {\r\n  locationHandler?: ((basename: string) => (state?: Partial<HistoryState<T>>) => Location<T>) | null;\r\n  baseHandler?: ((basename: string) => () => string) | null;\r\n}\r\n\r\nexport enum Action {\r\n  pop = 'POP',\r\n  push = 'PUSH',\r\n  replace = 'REPLACE',\r\n}\r\n\r\nexport enum EventType {\r\n  PopState = 'popstate',\r\n  HashChange = 'hashchange',\r\n}\r\n\r\nexport enum PopDirection {\r\n  back = 'back',\r\n  forward = 'forward',\r\n  unknown = '',\r\n}\r\n\r\nexport type Path = {\r\n  pathname: string;\r\n\r\n  search: string;\r\n\r\n  hash: string;\r\n};\r\n\r\nexport type HistoryState<T> = {\r\n  state?: T;\r\n\r\n  key: string;\r\n};\r\n\r\nexport type DefaultStateType = unknown;\r\n\r\nexport type Location<T = unknown> = Path & HistoryState<T>;\r\n\r\nexport type To = string | Partial<Path>;\r\n\r\nexport interface CommonListener<T = unknown> {\r\n  (navigation: Navigation<T>): void;\r\n}\r\n\r\nexport interface ActionInfo {\r\n  type: Action;\r\n  direction: PopDirection;\r\n  delta: number;\r\n}\r\n\r\nexport interface PopListener {\r\n  (to: string, from: string, information: ActionInfo): void;\r\n}\r\n\r\nexport interface PopNavigation {\r\n  to: string;\r\n  from: string;\r\n  information: ActionInfo;\r\n}\r\n\r\nexport type Listener<S> =\r\n  | {\r\n      type: 'common';\r\n      listener: CommonListener<S>;\r\n    }\r\n  | {\r\n      type: 'pop';\r\n      listener: PopListener;\r\n    };\r\n\r\nexport interface Navigation<T = unknown> {\r\n  action: Action;\r\n\r\n  location: Location<T>;\r\n}\r\n\r\nexport type Prompt<S> = string | boolean | null | ((location: Location<S>, action: Action) => void);\r\n\r\nexport type CallBackFunc = (isJump: boolean) => void;\r\n\r\nexport type ConfirmationFunc = (message: string, callBack: CallBackFunc) => void;\r\n\r\nexport interface TManager<S> {\r\n  setPrompt(next: Prompt<S>): () => void;\r\n\r\n  confirmJumpTo(\r\n    location: Location<S>,\r\n    action: Action,\r\n    userConfirmationFunc: ConfirmationFunc,\r\n    callBack: CallBackFunc\r\n  ): void;\r\n}\r\n","export default function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}","import { Action, Location, Path, To } from './types';\r\n\r\nexport function createPath(path: Partial<Path>): string {\r\n  const { search, hash } = path;\r\n  let pathname = path.pathname || '/';\r\n  if (search && search !== '?') {\r\n    pathname += search.startsWith('?') ? search : '?' + search;\r\n  }\r\n  if (hash && hash !== '#') {\r\n    pathname += hash.startsWith('#') ? hash : '#' + hash;\r\n  }\r\n  return pathname;\r\n}\r\n\r\nexport function parsePath(url: string): Partial<Path> {\r\n  let pathname = url || '/';\r\n  const parsedPath: Partial<Path> = {\r\n    search: '',\r\n    hash: '',\r\n  };\r\n\r\n  const hashIdx = url.indexOf('#');\r\n  if (hashIdx > -1) {\r\n    const hash = url.substring(hashIdx);\r\n    parsedPath.hash = hash === '#' ? '' : hash;\r\n    pathname = pathname.substring(0, hashIdx);\r\n  }\r\n\r\n  const searchIdx = url.indexOf('?');\r\n  if (searchIdx > -1) {\r\n    const search = url.substring(searchIdx);\r\n    parsedPath.search = search === '?' ? '' : search;\r\n    pathname = pathname.substring(0, searchIdx);\r\n  }\r\n  parsedPath.pathname = pathname;\r\n  return parsedPath;\r\n}\r\n\r\nexport function createLocation<S>(current: string | Location, to: To, state?: S, key?: string): Readonly<Location<S>> {\r\n  const pathname = typeof current === 'string' ? current : current.pathname;\r\n  const urlObj = typeof to === 'string' ? parsePath(to) : to;\r\n  // 随机key长度取6\r\n  const getRandKey = genRandomKey(6);\r\n  const location = {\r\n    pathname: pathname,\r\n    search: '',\r\n    hash: '',\r\n    state: state,\r\n    key: typeof key === 'string' ? key : getRandKey(),\r\n    ...urlObj,\r\n  };\r\n  if (!location.pathname) {\r\n    location.pathname = pathname ? pathname : '/';\r\n  } else if (!location.pathname.startsWith('/')) {\r\n    location.pathname = parseRelativePath(location.pathname, pathname);\r\n  }\r\n  if (location.search && location.search[0] !== '?') {\r\n    location.search = '?' + location.search;\r\n  }\r\n  if (location.hash && location.hash[0] !== '#') {\r\n    location.hash = '#' + location.hash;\r\n  }\r\n  return location;\r\n}\r\n\r\nexport function isLocationEqual(p1: Partial<Path>, p2: Partial<Path>) {\r\n  return p1.pathname === p2.pathname && p1.search === p2.search && p1.hash === p2.hash;\r\n}\r\n\r\nexport function addHeadSlash(path: string): string {\r\n  if (path[0] === '/') {\r\n    return path;\r\n  }\r\n  return '/' + path;\r\n}\r\n\r\nexport function stripHeadSlash(path: string): string {\r\n  if (path[0] === '/') {\r\n    return path.substring(1);\r\n  }\r\n  return path;\r\n}\r\n\r\nexport function normalizeSlash(path: string): string {\r\n  const tempPath = addHeadSlash(path);\r\n  if (tempPath[tempPath.length - 1] === '/') {\r\n    return tempPath.substring(0, tempPath.length - 1);\r\n  }\r\n  return tempPath;\r\n}\r\n\r\nexport function hasBasename(path: string, prefix: string): boolean {\r\n  return (\r\n    path.toLowerCase().indexOf(prefix.toLowerCase()) === 0 && ['/', '?', '#', ''].includes(path.charAt(prefix.length))\r\n  );\r\n}\r\n\r\nexport function stripBasename(path: string, prefix: string): string {\r\n  return hasBasename(path, prefix) ? path.substring(prefix.length) : path;\r\n}\r\n\r\n// 使用随机生成的Key记录被访问过的URL，当Block被被触发时利用delta值跳转到之前的页面\r\nexport function createMemoryRecord<T, S>(initVal: S, fn: (arg: S) => T) {\r\n  let visitedRecord: T[] = [fn(initVal)];\r\n\r\n  function getDelta(to: S, from: S): number {\r\n    let toIdx = visitedRecord.lastIndexOf(fn(to));\r\n    if (toIdx === -1) {\r\n      toIdx = 0;\r\n    }\r\n    let fromIdx = visitedRecord.lastIndexOf(fn(from));\r\n    if (fromIdx === -1) {\r\n      fromIdx = 0;\r\n    }\r\n    return toIdx - fromIdx;\r\n  }\r\n\r\n  function addRecord(current: S, newRecord: S, action: Action) {\r\n    const curVal = fn(current);\r\n    const NewVal = fn(newRecord);\r\n    if (action === Action.push) {\r\n      const prevIdx = visitedRecord.lastIndexOf(curVal);\r\n      const newVisitedRecord = visitedRecord.slice(0, prevIdx + 1);\r\n      newVisitedRecord.push(NewVal);\r\n      visitedRecord = newVisitedRecord;\r\n    }\r\n    if (action === Action.replace) {\r\n      const prevIdx = visitedRecord.lastIndexOf(curVal);\r\n      if (prevIdx !== -1) {\r\n        visitedRecord[prevIdx] = NewVal;\r\n      }\r\n    }\r\n  }\r\n\r\n  return { getDelta, addRecord };\r\n}\r\n\r\nfunction genRandomKey(length: number): () => string {\r\n  const end = length + 2;\r\n  return () => {\r\n    return Math.random().toString(18).substring(2, end);\r\n  };\r\n}\r\n\r\nexport function parseRelativePath(to: string, from: string) {\r\n  if (to.startsWith('/')) {\r\n    return to;\r\n  }\r\n  const fromParts = from.split('/');\r\n  const toParts = to.split('/');\r\n  const lastToPart = toParts[toParts.length - 1];\r\n  if (lastToPart === '..' || lastToPart === '.') {\r\n    toParts.push('');\r\n  }\r\n  let index = fromParts.length - 1;\r\n  let toIndex = 0;\r\n  let urlPart: string;\r\n\r\n  while (toIndex < toParts.length) {\r\n    urlPart = toParts[toIndex];\r\n    if (urlPart === '.') {\r\n      continue;\r\n    }\r\n    if (urlPart === '..') {\r\n      if (index > 1) {\r\n        index--;\r\n      }\r\n      toIndex++;\r\n    } else {\r\n      break;\r\n    }\r\n  }\r\n  return fromParts.slice(0, index).join('/') + '/' + toParts.slice(toIndex).join('/');\r\n}\r\n","export default function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nexport default function toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : String(i);\n}","import _typeof from \"./typeof.js\";\nexport default function toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, toPropertyKey(descriptor.key), descriptor);\n  }\n}\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","import type { Action, CallBackFunc, ConfirmationFunc, Location, Prompt, TManager } from './types';\r\n\r\nclass TransitionManager<S> implements TManager<S> {\r\n  private prompt: Prompt<S>;\r\n\r\n  constructor() {\r\n    this.prompt = null;\r\n  }\r\n\r\n  public setPrompt(prompt: Prompt<S>): () => void {\r\n    this.prompt = prompt;\r\n\r\n    // 清除Prompt\r\n    return () => {\r\n      if (this.prompt === prompt) {\r\n        this.prompt = null;\r\n      }\r\n    };\r\n  }\r\n\r\n  public confirmJumpTo(\r\n    location: Location<S>,\r\n    action: Action,\r\n    userConfirmationFunc: ConfirmationFunc,\r\n    callBack: CallBackFunc\r\n  ) {\r\n    if (this.prompt !== null) {\r\n      const result = typeof this.prompt === 'function' ? this.prompt(location, action) : this.prompt;\r\n      if (typeof result === 'string') {\r\n        typeof userConfirmationFunc === 'function' ? userConfirmationFunc(result, callBack) : callBack(true);\r\n      } else {\r\n        callBack(result !== false);\r\n      }\r\n    } else {\r\n      callBack(true);\r\n    }\r\n  }\r\n}\r\n\r\nexport default TransitionManager;\r\n","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function warning(condition: any, message: string) {\r\n  if (condition) {\r\n    if (console && typeof console.warn === 'function') {\r\n      console.warn(message);\r\n    }\r\n  }\r\n}\r\n\r\nexport default warning;","import { getDefaultConfirmation, isSupportHistory, isSupportsPopState } from './dom';\r\nimport {\r\n  Action,\r\n  AgnosticHistory,\r\n  BaseOption,\r\n  CommonListener,\r\n  DefaultStateType,\r\n  EventType,\r\n  History,\r\n  HistoryState,\r\n  Listener,\r\n  Location,\r\n  LocationHandler,\r\n  Path,\r\n  To,\r\n} from './types';\r\nimport { createLocation, createMemoryRecord, createPath, normalizeSlash, stripBasename } from './utils';\r\nimport TransitionManager from './transitionManager';\r\n\r\nimport warning from './waring';\r\nimport { getBaseHistory } from './baseHistory';\r\n\r\nexport type BrowserHistoryOption = {\r\n  /**\r\n   * forceRefresh为True时跳转时会强制刷新页面\r\n   */\r\n  forceRefresh?: boolean;\r\n} & BaseOption;\r\n\r\nexport function createBrowserHistory<S = DefaultStateType>(options: BrowserHistoryOption): History<S>;\r\n/**\r\n * @internal\r\n * @desc this override signature only for internal usage\r\n */\r\nexport function createBrowserHistory<S = DefaultStateType>(\r\n  options: LocationHandler<S> & BrowserHistoryOption\r\n): AgnosticHistory<S>;\r\nexport function createBrowserHistory<S = DefaultStateType>(\r\n  options: LocationHandler<S> & BrowserHistoryOption = {}\r\n): AgnosticHistory<S> {\r\n  const supportHistory = isSupportHistory();\r\n  const isSupportPopState = isSupportsPopState();\r\n  const browserHistory = window.history;\r\n  const { forceRefresh = false, getUserConfirmation = getDefaultConfirmation } = options;\r\n\r\n  const basename = options.basename ? normalizeSlash(options.basename) : '';\r\n\r\n  const initLocation = getLocation(getHistoryState());\r\n\r\n  const recordOperator = createMemoryRecord<string, Location<S>>(initLocation, l => l.key);\r\n\r\n  const transitionManager = new TransitionManager<S>();\r\n\r\n  const { go, addListener, block, destroy, getUpdateStateFunc } = getBaseHistory<S>(\r\n    'browser',\r\n    transitionManager,\r\n    handlePop\r\n  );\r\n\r\n  const listen = (listener: CommonListener<S>) => {\r\n    const trigger: Listener<S> = { type: 'common', listener: listener };\r\n    return addListener(trigger);\r\n  };\r\n\r\n  const history: AgnosticHistory<S> = {\r\n    action: Action.pop,\r\n    length: browserHistory.length,\r\n    location: initLocation,\r\n    go,\r\n    goBack: () => go(-1),\r\n    goForward: () => go(-1),\r\n    listen,\r\n    addListener,\r\n    block,\r\n    push,\r\n    replace,\r\n    destroy,\r\n    createHref,\r\n  };\r\n\r\n  const updateState = getUpdateStateFunc(history);\r\n\r\n  function getHistoryState() {\r\n    return supportHistory ? window.history.state : {};\r\n  }\r\n\r\n  function getLocation(historyState: Partial<HistoryState<S>>) {\r\n    const { search, hash } = window.location;\r\n    const { key, state } = historyState || {};\r\n    let pathname = window.location.pathname;\r\n    pathname = basename ? stripBasename(pathname, basename) : pathname;\r\n\r\n    return createLocation<S>('', { pathname, search, hash }, state, key);\r\n  }\r\n\r\n  // 拦截页面POP事件后，防止返回到的页面被重复拦截\r\n  let forceJump = false;\r\n\r\n  function handlePopState(location: Location<S>) {\r\n    if (forceJump) {\r\n      forceJump = false;\r\n      updateState(undefined);\r\n    } else {\r\n      const action = Action.pop;\r\n\r\n      const callback = (isJump: boolean) => {\r\n        if (isJump) {\r\n          // 执行跳转行为\r\n          updateState({ action: action, location: location });\r\n        } else {\r\n          revertPopState(location, history.location);\r\n        }\r\n      };\r\n\r\n      transitionManager.confirmJumpTo(location, action, getUserConfirmation, callback);\r\n    }\r\n  }\r\n\r\n  const isEventPopState = (event: Event): event is PopStateEvent => {\r\n    return event.type === EventType.PopState;\r\n  };\r\n\r\n  function handlePop(event: PopStateEvent | HashChangeEvent) {\r\n    const historyState = isSupportPopState && isEventPopState(event) ? event.state : getHistoryState();\r\n    const handler = options.locationHandler ? options.locationHandler : getLocation;\r\n    handlePopState(handler(historyState));\r\n  }\r\n\r\n  // 取消页面跳转并恢复到跳转前的页面\r\n  function revertPopState(from: Location<S>, to: Location<S>) {\r\n    const delta = recordOperator.getDelta(to, from);\r\n    if (delta !== 0) {\r\n      go(delta);\r\n      forceJump = true;\r\n    }\r\n  }\r\n\r\n  function createHref(path: Partial<Path>) {\r\n    return (options.baseHandler ? options.baseHandler() : basename) + createPath(path);\r\n  }\r\n\r\n  function push(to: To, state?: S) {\r\n    const action = Action.push;\r\n    const location = createLocation<S>(history.location, to, state, undefined);\r\n\r\n    transitionManager.confirmJumpTo(location, action, getUserConfirmation, isJump => {\r\n      if (!isJump) {\r\n        return;\r\n      }\r\n      const href = createHref(location);\r\n      const { key, state } = location;\r\n\r\n      if (supportHistory) {\r\n        if (forceRefresh) {\r\n          window.location.href = href;\r\n        } else {\r\n          browserHistory.pushState({ key: key, state: state }, '', href);\r\n          recordOperator.addRecord(history.location, location, action);\r\n          updateState({ action, location });\r\n        }\r\n      } else {\r\n        warning(state !== undefined, 'Browser history cannot push state in browsers that do not support HTML5 history');\r\n        window.location.href = href;\r\n      }\r\n    });\r\n  }\r\n\r\n  function replace(to: To, state?: S) {\r\n    const action = Action.replace;\r\n    const location = createLocation<S>(history.location, to, state, undefined);\r\n\r\n    transitionManager.confirmJumpTo(location, action, getUserConfirmation, isJump => {\r\n      if (!isJump) {\r\n        return;\r\n      }\r\n      const href = createHref(location);\r\n      const { key, state } = location;\r\n      if (supportHistory) {\r\n        if (forceRefresh) {\r\n          window.location.replace(href);\r\n        } else {\r\n          browserHistory.replaceState({ key: key, state: state }, '', href);\r\n          recordOperator.addRecord(history.location, location, action);\r\n          updateState({ action, location });\r\n        }\r\n      } else {\r\n        warning(state !== undefined, 'Browser history cannot push state in browsers that do not support HTML5 history');\r\n        window.location.replace(href);\r\n      }\r\n    });\r\n  }\r\n\r\n  return history;\r\n}\r\n","import { Action, EventType, HistoryProps, Listener, Navigation, PopDirection, PopNavigation, Prompt } from './types';\r\nimport transitionManager from './transitionManager';\r\nimport { isSupportsPopState } from './dom';\r\nimport { createPath } from './utils';\r\n\r\ntype Trigger<S> =\r\n  | {\r\n      type: 'common';\r\n      trigger: (arg: Navigation<S>) => void;\r\n    }\r\n  | {\r\n      type: 'pop';\r\n      trigger: (arg: PopNavigation) => void;\r\n    };\r\n\r\n// 抽取BrowserHistory和HashHistory中相同的方法\r\nexport function getBaseHistory<S>(\r\n  type: 'browser' | 'hash' = 'browser',\r\n  transitionManager: transitionManager<S>,\r\n  popActionListener: (event: PopStateEvent | HashChangeEvent) => void\r\n) {\r\n  let listenerCount = 0;\r\n  const supportPopState = isSupportsPopState();\r\n  let listeners: Trigger<S>[] = [];\r\n  const unListeners: (() => void)[] = [];\r\n  const browserHistory = window.history;\r\n\r\n  // 标记是否暂停触发type为pop类型的listener\r\n  let pauseTrigger = false;\r\n\r\n  function go(step: number, triggerListener = true) {\r\n    if (triggerListener) {\r\n      pauseTrigger = true;\r\n    }\r\n    browserHistory.go(step);\r\n  }\r\n\r\n  function setupListener(count: number | null) {\r\n    if (count === null) {\r\n      listenerCount = 0;\r\n    } else {\r\n      listenerCount += count;\r\n    }\r\n    if (listenerCount === 1 && count === 1) {\r\n      if (type === 'browser' && supportPopState) {\r\n        addEventListener(EventType.PopState, popActionListener);\r\n      } else {\r\n        addEventListener(EventType.HashChange, popActionListener);\r\n      }\r\n    } else if (listenerCount === 0) {\r\n      if (type === 'browser' && supportPopState) {\r\n        removeEventListener(EventType.PopState, popActionListener);\r\n      } else {\r\n        removeEventListener(EventType.HashChange, popActionListener);\r\n      }\r\n    }\r\n  }\r\n\r\n  function addListener(listener: Listener<S>): () => void {\r\n    let isActive = true;\r\n    const wrapper = (args: Navigation<S> | PopNavigation) => {\r\n      if (isActive) {\r\n        if (listener.type === 'common' && 'action' in args) {\r\n          listener.listener(args);\r\n        } else if (listener.type === 'pop' && 'to' in args) {\r\n          listener.listener(args.to, args.from, args.information);\r\n        }\r\n      }\r\n    };\r\n    const trigger: Trigger<S> = { type: listener.type, trigger: wrapper };\r\n    listeners.push(trigger);\r\n    setupListener(1);\r\n\r\n    const cancelListener = () => {\r\n      isActive = false;\r\n      setupListener(-1);\r\n      listeners = listeners.filter(listener => listener !== trigger);\r\n    };\r\n\r\n    unListeners.push(cancelListener);\r\n    return cancelListener;\r\n  }\r\n\r\n  function destroy() {\r\n    for (const unListen of unListeners) {\r\n      unListen();\r\n    }\r\n    unListeners.length = 0;\r\n    setupListener(null);\r\n  }\r\n\r\n  let isBlocked = false;\r\n\r\n  function block(prompt: Prompt<S> = false): () => void {\r\n    const unblock = transitionManager.setPrompt(prompt);\r\n    if (!isBlocked) {\r\n      setupListener(1);\r\n      isBlocked = true;\r\n    }\r\n    return () => {\r\n      if (isBlocked) {\r\n        isBlocked = false;\r\n        setupListener(-1);\r\n      }\r\n      unblock();\r\n    };\r\n  }\r\n\r\n  function getUpdateStateFunc(historyProps: HistoryProps<S>) {\r\n    return function (nextState: Navigation<S> | undefined) {\r\n      const originPath = createPath(historyProps.location);\r\n      if (nextState) {\r\n        Object.assign(historyProps, nextState);\r\n      }\r\n      const delta = browserHistory.length - historyProps.length;\r\n      historyProps.length = browserHistory.length;\r\n      // 避免location引用相同时setState不触发\r\n      const location = Object.assign({}, historyProps.location);\r\n      const commonArgs = { location: location, action: historyProps.action };\r\n      const popArgs: PopNavigation = {\r\n        to: createPath(location),\r\n        from: originPath,\r\n        information: {\r\n          delta: delta,\r\n          direction: delta > 0 ? PopDirection.forward : PopDirection.back,\r\n          type: Action.pop,\r\n        },\r\n      };\r\n      for (let i = 0; i < listeners.length && !pauseTrigger; i++) {\r\n        const listener = listeners[i];\r\n        if (listener.type === 'common') {\r\n          listener.trigger(commonArgs);\r\n        } else if (listener.type === 'pop' && historyProps.action === Action.pop) {\r\n          // vue history listener only trigger when action is pop\r\n          listener.trigger(popArgs);\r\n        }\r\n      }\r\n      pauseTrigger = false;\r\n    };\r\n  }\r\n\r\n  return { go, addListener, block, destroy, getUpdateStateFunc };\r\n}\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport type { HistoryLocation } from './vueHistory';\r\nimport { normalizeSlash, parseRelativePath } from '../history/utils';\r\nimport type { LocationQuery, RouteLocation, RouteLocationRaw } from './types';\r\n\r\nexport function normalizeBase(base?: string): string {\r\n  if (!base) {\r\n    if (typeof document !== 'undefined') {\r\n      const baseEl = document.querySelector('base');\r\n      base = (baseEl && baseEl.getAttribute('href')) || '/';\r\n      base = base.replace(/^\\w+:\\/\\/[^\\/]+/, '');\r\n    } else {\r\n      base = '/';\r\n    }\r\n  }\r\n  if (base[0] !== '/' && base[0] !== '#') {\r\n    base = `/${base}`;\r\n  }\r\n  return normalizeSlash(base);\r\n}\r\n\r\nconst BEFORE_HASH_RE = /^[^#]+#/;\r\n\r\nexport function createHrefHandler(base: string): (location: HistoryLocation) => string {\r\n  return (location: HistoryLocation) => base.replace(BEFORE_HASH_RE, '#') + location;\r\n}\r\n\r\nexport interface NormalizedLocation {\r\n  path: string;\r\n  fullPath: string;\r\n  hash: string;\r\n  query: LocationQuery;\r\n}\r\n\r\nexport function parseURL(location: string, currentLocation: string = '/'): NormalizedLocation {\r\n  let path: string | undefined,\r\n    query: LocationQuery = {},\r\n    searchString = '',\r\n    hash = '';\r\n\r\n  // Could use URL and URLSearchParams but IE 11 doesn't support it\r\n  // TODO: move to new URL()\r\n  const hashPos = location.indexOf('#');\r\n  let searchPos = location.indexOf('?');\r\n  // the hash appears before the search, so it's not part of the search string\r\n  if (hashPos < searchPos && hashPos >= 0) {\r\n    searchPos = -1;\r\n  }\r\n\r\n  if (searchPos > -1) {\r\n    path = location.slice(0, searchPos);\r\n    searchString = location.slice(searchPos + 1, hashPos > -1 ? hashPos : location.length);\r\n\r\n    query = parseQuery(searchString);\r\n  }\r\n\r\n  if (hashPos > -1) {\r\n    path = path || location.slice(0, hashPos);\r\n    // keep the # character\r\n    hash = location.slice(hashPos, location.length);\r\n  }\r\n\r\n  // no search and no query\r\n  path = parseRelativePath(path != null ? path : location, currentLocation);\r\n  // empty path means a relative query or hash `?foo=f`, `#thing`\r\n\r\n  return {\r\n    fullPath: path + (searchString && '?') + searchString + hash,\r\n    path,\r\n    query,\r\n    hash: decode(hash),\r\n  };\r\n}\r\n\r\nexport function stringifyUrl(location: Partial<Omit<NormalizedLocation, 'fullPath'>>): string {\r\n  const query: string = location.query ? stringifyQuery(location.query) : '';\r\n  return location.path + (query && '?') + query + (location.hash || '');\r\n}\r\n\r\nfunction stringifyQuery(query: LocationQuery): string {\r\n  const urlParams = new URLSearchParams();\r\n  const keys = Object.keys(query);\r\n  for (const key of keys) {\r\n    const value = query[key];\r\n    if (Array.isArray(value)) {\r\n      value.forEach(v => {\r\n        if (v) {\r\n          urlParams.append(key, v);\r\n        }\r\n      });\r\n    } else if (value !== undefined && value !== null) {\r\n      urlParams.append(key, value.toString());\r\n    }\r\n  }\r\n  return urlParams.toString();\r\n}\r\n\r\nexport function normalizeQuery(query: Record<string | number, any> | undefined): LocationQuery {\r\n  const normalizedQuery: LocationQuery = {};\r\n\r\n  for (const key in query) {\r\n    const value = query[key];\r\n    if (value !== undefined) {\r\n      normalizedQuery[key] = Array.isArray(value)\r\n        ? value.map(v => (v == null ? null : '' + v))\r\n        : value == null\r\n          ? value\r\n          : '' + value;\r\n    }\r\n  }\r\n  return normalizedQuery;\r\n}\r\n\r\nexport function locationToObject(\r\n  location: RouteLocationRaw,\r\n  currentRoute: RouteLocation\r\n): Exclude<RouteLocationRaw, string> {\r\n  return typeof location === 'string' ? parseURL(location, currentRoute.path) : { ...location };\r\n}\r\n\r\nfunction parseQuery(queryString: string): LocationQuery {\r\n  const params = new URLSearchParams(queryString);\r\n  return Object.fromEntries(params.entries());\r\n}\r\n\r\nfunction decode(text: string | number): string {\r\n  return decodeURIComponent(String(text));\r\n}\r\n\r\nfunction shallowCompareArray<T>(a: T[], b: T[] | T): boolean {\r\n  return Array.isArray(b) ? a.length === b.length && a.every((v, i) => b[i] === v) : a.length === 1 && a[0] === b;\r\n}\r\n\r\nfunction compareParams(a: RouteLocation['params'], b: RouteLocation['params']): boolean {\r\n  const aKeys = Object.keys(a);\r\n  const bKeys = Object.keys(b);\r\n  if (aKeys.length !== bKeys.length) {\r\n    return false;\r\n  }\r\n  for (const key of aKeys) {\r\n    const aValue = a[key];\r\n    const bValue = b[key];\r\n    if (Array.isArray(aValue)) {\r\n      if (!shallowCompareArray(aValue, bValue)) {\r\n        return false;\r\n      }\r\n    } else if (Array.isArray(bValue)) {\r\n      if (!shallowCompareArray(bValue, aValue)) {\r\n        return false;\r\n      }\r\n    } else {\r\n      return a === b;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isSameRouteLocation(a: RouteLocation, b: RouteLocation): boolean {\r\n  const matchLengthA = a.matched.length - 1;\r\n  const matchLengthB = b.matched.length - 1;\r\n\r\n  return (\r\n    matchLengthA >= -1 &&\r\n    matchLengthA === matchLengthB &&\r\n    a.matched[matchLengthA] === b.matched[matchLengthB] &&\r\n    compareParams(a.params, b.params) &&\r\n    stringifyQuery(a.query) === stringifyQuery(b.query) &&\r\n    a.hash === b.hash\r\n  );\r\n}\r\n\r\nexport function createCallBackList<T>() {\r\n  let callbacks: T[] = [];\r\n\r\n  const add = (cb: T) => {\r\n    callbacks.push(cb);\r\n    return () => {\r\n      callbacks = callbacks.filter(item => item !== cb);\r\n    };\r\n  };\r\n\r\n  return {\r\n    add,\r\n    list: () => callbacks.slice(0),\r\n    clear: () => (callbacks.length = 0),\r\n  };\r\n}\r\n\r\nexport function guardEvent(e: MouseEvent) {\r\n  // don't redirect with control keys\r\n  if (e.metaKey || e.altKey || e.ctrlKey || e.shiftKey) return;\r\n  // don't redirect when preventDefault called\r\n  if (e.defaultPrevented) return;\r\n  // don't redirect on right click\r\n  if (e.button !== undefined && e.button !== 0) return;\r\n  // don't redirect if `target=\"_blank\"`\r\n  // @ts-expect-error getAttribute does exist\r\n  if (e.currentTarget && e.currentTarget.getAttribute) {\r\n    // @ts-expect-error getAttribute exists\r\n    const target = e.currentTarget.getAttribute('target');\r\n    if (/\\b_blank\\b/i.test(target)) return;\r\n  }\r\n  // this may be a Weex event which doesn't have this method\r\n  if (e.preventDefault) e.preventDefault();\r\n\r\n  return true;\r\n}\r\n\r\nexport function includesParams(outer: RouteLocation['params'], inner: RouteLocation['params']): boolean {\r\n  for (const key in inner) {\r\n    const innerValue = inner[key];\r\n    const outerValue = outer[key];\r\n    if (typeof innerValue === 'string') {\r\n      if (innerValue !== outerValue) return false;\r\n    } else {\r\n      if (\r\n        !Array.isArray(outerValue) ||\r\n        outerValue.length !== innerValue.length ||\r\n        innerValue.some((value, i) => value !== outerValue[i])\r\n      )\r\n        return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { createBrowserHistory } from '../history/browerHistory';\r\nimport { createHrefHandler, normalizeBase } from './utils';\r\nimport { createLocation, createPath, stripBasename, addHeadSlash } from '../history/utils';\r\nimport type { ActionInfo, CommonListener, CreateLocationHandler } from '../history/types';\r\n\r\nexport type HistoryLocation = string;\r\nexport type HistoryState = {\r\n  [key: string | number]: HistoryStateValue;\r\n};\r\ntype HistoryStateValue = string | number | boolean | null | undefined | HistoryState | HistoryStateValue[];\r\n\r\ninterface HistoryCallback {\r\n  (to: HistoryLocation, from: HistoryLocation, information: ActionInfo): void;\r\n}\r\n\r\nexport interface VueHistory {\r\n  // props\r\n  readonly base: string;\r\n  readonly location: HistoryLocation;\r\n  readonly state: HistoryState;\r\n\r\n  // methods\r\n  push(to: HistoryLocation, data?: HistoryState): void;\r\n\r\n  replace(to: HistoryLocation, data?: HistoryState): void;\r\n\r\n  go(delta: number, triggerListeners?: boolean): void;\r\n\r\n  listen(cb: HistoryCallback): () => void;\r\n\r\n  /**\r\n   * @internal\r\n   * @desc use for internal only\r\n   * @param listener {CommonListener}\r\n   */\r\n  listenLocation(listener: CommonListener): () => void;\r\n\r\n  createHref(location: HistoryLocation): string;\r\n\r\n  destroy(): void;\r\n}\r\n\r\nfunction createVueBaseHistory(handler: CreateLocationHandler<any>, base?: string): VueHistory {\r\n  const urlBase = normalizeBase(base);\r\n  const locationHandler = handler.locationHandler ? handler.locationHandler(urlBase) : null;\r\n  const hrefHandler = handler.baseHandler ? handler.baseHandler(urlBase) : null;\r\n  const baseHistory = createBrowserHistory<any>({ basename: urlBase, locationHandler, baseHandler: hrefHandler });\r\n\r\n  const listen = (listener: HistoryCallback) => {\r\n    return baseHistory.addListener({ type: 'pop', listener: listener });\r\n  };\r\n\r\n  const listenLocation = (listener: CommonListener) => {\r\n    return baseHistory.listen(listener);\r\n  };\r\n\r\n  const push = (to: HistoryLocation, data?: HistoryState) => {\r\n    return baseHistory.push(stripBasename(to, urlBase), data);\r\n  };\r\n\r\n  const replace = (to: HistoryLocation, data?: HistoryState) => {\r\n    return baseHistory.replace(stripBasename(to, urlBase), data);\r\n  };\r\n\r\n  const historyAdapter: VueHistory = {\r\n    base: urlBase,\r\n    location: '',\r\n    state: {},\r\n    go: baseHistory.go,\r\n    push: push,\r\n    listen,\r\n    listenLocation,\r\n    replace: replace,\r\n    destroy: baseHistory.destroy,\r\n    createHref: createHrefHandler(urlBase),\r\n  };\r\n\r\n  // let location and state readonly\r\n  Object.defineProperties(historyAdapter, {\r\n    location: {\r\n      enumerable: true,\r\n      get: () => createPath(locationHandler ? locationHandler(baseHistory.location) : baseHistory.location),\r\n    },\r\n    state: {\r\n      enumerable: true,\r\n      get: () => baseHistory.location.state,\r\n    },\r\n  });\r\n\r\n  return historyAdapter;\r\n}\r\n\r\nfunction createWebHistory(base?: string): VueHistory {\r\n  return createVueBaseHistory({}, base);\r\n}\r\n\r\nfunction createWebHashHistory(base?: string): VueHistory {\r\n  base = location.host ? base || location.pathname + location.search : '';\r\n\r\n  if (!base.includes('#')) {\r\n    base += '#';\r\n  }\r\n\r\n  const getLocation = (basename: string) => () => {\r\n    const { pathname, search, hash } = window.location;\r\n    const hashPos = basename.indexOf('#');\r\n    if (hashPos > -1) {\r\n      const slicePos = hash.includes(basename.slice(hashPos)) ? basename.slice(hashPos).length : 1;\r\n      const pathFromHash = addHeadSlash(hash.slice(slicePos));\r\n      return createLocation('', pathFromHash);\r\n    }\r\n    const path = stripBasename(pathname, basename);\r\n    return createLocation('', path + search + hash);\r\n  };\r\n\r\n  const getBase = (base: string) => () => {\r\n    const hashIndex = base.indexOf('#');\r\n    if (hashIndex !== -1) {\r\n      return window.location.host && document.querySelector('base') ? base : base.slice(hashIndex);\r\n    }\r\n    return location.protocol + '//' + location.host + base;\r\n  };\r\n\r\n  const hashHandlers: CreateLocationHandler<any> = { locationHandler: getLocation, baseHandler: getBase };\r\n\r\n  return createVueBaseHistory(hashHandlers, base);\r\n}\r\n\r\nexport { createWebHistory, createWebHashHistory };\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport type { RouteLocation } from './types';\r\n\r\nexport const START_LOCATION: RouteLocation = {\r\n  path: '/',\r\n  params: {},\r\n  query: {},\r\n  hash: '',\r\n  fullPath: '/',\r\n  meta: {},\r\n  matched: [],\r\n};\r\n\r\nexport const enum ErrorTypes {\r\n  MATCHER_NOT_FOUND = 1,\r\n  NAVIGATION_GUARD_REDIRECT = 2,\r\n  NAVIGATION_ABORTED = 4,\r\n  NAVIGATION_CANCELLED = 8,\r\n  NAVIGATION_DUPLICATED = 16,\r\n}\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { createContext } from '@cloudsop/horizon';\r\nimport type { NormalizedRouteRecord, RouteLocation } from './types';\r\nimport type { VueRouter } from './Router';\r\nimport { START_LOCATION } from './const';\r\n\r\nexport const RouterContext = createContext<VueRouter>(null as any);\r\n\r\nexport const RouteContext = createContext<RouteLocation>(START_LOCATION);\r\n\r\nexport const CurrentRouteRecord = createContext<NormalizedRouteRecord>(null as any);\r\n\r\n// provide match depth for <RouterView/>\r\nexport const ViewDepth = createContext<{ depth: number }>({ depth: 0 });\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { Matched, Params } from './parser';\r\n\r\nexport type Token = {\r\n  type: TokenType;\r\n  value: string;\r\n};\r\n\r\nexport enum TokenType {\r\n  Delimiter = 'delimiter',\r\n  Static = 'static',\r\n  Param = 'param',\r\n  WildCard = 'wildcard',\r\n  LBracket = '(',\r\n  RBracket = ')',\r\n  Pattern = 'pattern',\r\n}\r\n\r\nexport interface Parser<P> {\r\n  regexp: RegExp;\r\n\r\n  keys: string[];\r\n\r\n  score: number[];\r\n\r\n  parse(url: string): Matched<P> | null;\r\n\r\n  compile(params: Params<P>): string;\r\n}\r\n\r\nexport type ParserOption = {\r\n  // 是否大小写敏感\r\n  caseSensitive?: boolean;\r\n  // 是否启用严格模式\r\n  strictMode?: boolean;\r\n  // 精准匹配 兼容 React-RouterV5\r\n  exact?: boolean;\r\n};\r\n\r\ntype ClearLeading<U extends string> = U extends `/${infer R}` ? ClearLeading<R> : U;\r\ntype ClearTailing<U extends string> = U extends `${infer L}/` ? ClearTailing<L> : U;\r\n\r\ntype ParseParam<Param extends string> = Param extends `:${infer R}`\r\n  ? {\r\n      [K in R]: string;\r\n    }\r\n  : {};\r\n\r\ntype MergeParams<OneParam extends Record<string, any>, OtherParam extends Record<string, any>> = {\r\n  readonly [Key in keyof OneParam | keyof OtherParam]?: string;\r\n};\r\n\r\ntype ParseURLString<Str extends string> = Str extends `${infer Param}/${infer Rest}`\r\n  ? MergeParams<ParseParam<Param>, ParseURLString<ClearLeading<Rest>>>\r\n  : ParseParam<Str>;\r\n\r\n// 解析URL中的动态参数，以实现TypeScript提示功能\r\nexport type GetURLParams<U extends string> = ParseURLString<ClearLeading<ClearTailing<U>>>;\r\n","/**\r\n * @description 将url中的//转换为/\r\n */\r\nexport function cleanPath(path: string): string {\r\n  return path.replace(/\\/+/g, '/');\r\n}\r\n\r\nexport function scoreCompare(score1: number[], score2: number[]): number {\r\n  const score1Length = score1.length;\r\n  const score2Length = score2.length;\r\n  const end = Math.min(score1Length, score2Length);\r\n  for (let i = 0; i < end; i++) {\r\n    const delta = score2[i] - score1[i];\r\n    if (delta !== 0) {\r\n      return delta;\r\n    }\r\n  }\r\n  if (score1Length === score2Length) {\r\n    return 0;\r\n  }\r\n  return score1Length > score2Length ? -1 : 1;\r\n}\r\n\r\n// 把正则表达式的特殊符号加两个反斜杠进行转义\r\nexport function escapeStr(str: string) {\r\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, '\\\\$1');\r\n}\r\n","import { Token, TokenType } from './types';\r\nimport { cleanPath } from './utils';\r\n\r\nconst validChar = /[^/:()*?$^+]/;\r\n\r\n// 对Url模板进行词法解析，解析结果为Tokens\r\nexport function lexer(path: string): Token[] {\r\n  const tokens: Token[] = [];\r\n\r\n  if (!path) {\r\n    return tokens;\r\n  }\r\n\r\n  let urlPath = cleanPath(path);\r\n  if (urlPath !== '*' && !urlPath.startsWith('/')) {\r\n    throw new Error(`Url must start with \"/\".`);\r\n  }\r\n\r\n  const getLiteral = () => {\r\n    let name = '';\r\n    while (i < urlPath.length && validChar.test(urlPath[i])) {\r\n      name += urlPath[i];\r\n      skipChar(1);\r\n    }\r\n    return name;\r\n  };\r\n\r\n  const skipChar = (step: number) => {\r\n    i += step;\r\n  };\r\n\r\n  let i = 0;\r\n  while (i < urlPath.length) {\r\n    const curChar = urlPath[i];\r\n    const prevChar = urlPath[i - 1];\r\n\r\n    if (curChar === '/') {\r\n      tokens.push({ type: TokenType.Delimiter, value: urlPath[i] });\r\n      skipChar(1);\r\n      continue;\r\n    }\r\n    // dynamic params (/:a)\r\n    if (prevChar === '/' && curChar === ':') {\r\n      skipChar(1);\r\n      tokens.push({ type: TokenType.Param, value: getLiteral() });\r\n      continue;\r\n    }\r\n    // wildCard params (/:*)\r\n    if ((prevChar === '/' || prevChar === undefined) && curChar === '*') {\r\n      tokens.push({ type: TokenType.WildCard, value: urlPath[i] });\r\n      skipChar(1);\r\n      continue;\r\n    }\r\n    // static params\r\n    if (prevChar === '/' && validChar.test(curChar)) {\r\n      tokens.push({ type: TokenType.Static, value: getLiteral() });\r\n      continue;\r\n    }\r\n    if (curChar === '(') {\r\n      tokens.push({ type: TokenType.LBracket, value: '(' });\r\n      skipChar(1);\r\n      continue;\r\n    }\r\n    if (curChar === ')') {\r\n      tokens.push({ type: TokenType.RBracket, value: ')' });\r\n      skipChar(1);\r\n      continue;\r\n    }\r\n    if (['*', '?', '$', '^', '+'].includes(curChar)) {\r\n      tokens.push({ type: TokenType.Pattern, value: curChar });\r\n      skipChar(1);\r\n      continue;\r\n    }\r\n    if (validChar.test(curChar)) {\r\n      tokens.push({ type: TokenType.Pattern, value: getLiteral() });\r\n      continue;\r\n    }\r\n    // 跳过非法字符\r\n    skipChar(1);\r\n  }\r\n\r\n  return tokens;\r\n}\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { GetURLParams, Parser, ParserOption, TokenType } from './types';\r\nimport { lexer } from './lexer';\r\nimport { escapeStr, scoreCompare } from './utils';\r\n\r\n// 不同类型参数的匹配得分\r\nenum MatchScore {\r\n  // 固定参数\r\n  static = 10,\r\n  // 动态参数\r\n  param = 6,\r\n  // 通配符参数\r\n  wildcard = 3,\r\n  placeholder = -1,\r\n}\r\n\r\nexport type Params<P> = { [K in keyof P]?: P[K] };\r\n\r\n// 兼容 react v5 matched类型\r\nexport type Matched<P = any> = {\r\n  score: number[];\r\n  params: Params<P>;\r\n  path: string;\r\n  url: string;\r\n  isExact: boolean;\r\n};\r\n\r\nconst defaultOption: Required<ParserOption> = {\r\n  // url匹配时是否大小写敏感\r\n  caseSensitive: false,\r\n  // 是否严格匹配url结尾的/\r\n  strictMode: false,\r\n  // 是否完全精确匹配\r\n  exact: false,\r\n};\r\n// 正则表达式中需要转义的字符\r\nconst REGEX_CHARS_RE = /[.+*?^${}()[\\]/\\\\]/g;\r\n// 用于匹配两个//中的的值\r\nconst BASE_PARAM_PATTERN = '[^/]+';\r\n\r\nconst DefaultDelimiter = '/#?';\r\n\r\n/**\r\n * URL匹配整体流程\r\n * 1.词法解析，将URL模板解析为Token\r\n * 2.使用Token生成正则表达式\r\n * 3.利用正则表达式解析URL中参数或填充URL模板\r\n */\r\nexport function createPathParser<Str extends string>(pathname: Str, option?: ParserOption): Parser<GetURLParams<Str>>;\r\nexport function createPathParser<P = unknown>(pathname: string, option?: ParserOption): Parser<P>;\r\nexport function createPathParser<P = unknown>(pathname: string, option: ParserOption = defaultOption): Parser<P> {\r\n  const {\r\n    caseSensitive = defaultOption.caseSensitive,\r\n    strictMode = defaultOption.strictMode,\r\n    exact = defaultOption.exact,\r\n  } = option;\r\n\r\n  let pattern = '^';\r\n  const keys: string[] = [];\r\n  const scores: number[] = [];\r\n\r\n  const tokens = lexer(pathname);\r\n  const onlyHasWildCard = tokens.length === 1 && tokens[0].type === TokenType.WildCard;\r\n  const tokenCount = tokens.length;\r\n  const lastToken = tokens[tokenCount - 1];\r\n  let asteriskCount = 0;\r\n\r\n  /**\r\n   * 用于支持URL中的可选参数/:parma?\r\n   * @description 向前扫描到下一个分隔符/，检查其中是否有?\r\n   * @param currentIdx\r\n   */\r\n  const lookToNextDelimiter = (currentIdx: number): boolean => {\r\n    let hasOptionalParam = false;\r\n    while (currentIdx < tokens.length && tokens[currentIdx].type !== TokenType.Delimiter) {\r\n      if (tokens[currentIdx].value === '?' || tokens[currentIdx].value === '*') {\r\n        hasOptionalParam = true;\r\n      }\r\n      currentIdx++;\r\n    }\r\n    return hasOptionalParam;\r\n  };\r\n  for (let tokenIdx = 0; tokenIdx < tokenCount; tokenIdx++) {\r\n    const token = tokens[tokenIdx];\r\n    const nextToken = tokens[tokenIdx + 1];\r\n    switch (token.type) {\r\n      case TokenType.Delimiter: {\r\n        // 该分隔符后有可选参数则该分割符在匹配时是可选的\r\n        const hasOptional = lookToNextDelimiter(tokenIdx + 1);\r\n        // 该分隔符为最后一个且strictMode===false时，该分割符在匹配时是可选的\r\n        const isSlashOptional = nextToken === undefined && !strictMode;\r\n        pattern += `/${hasOptional || isSlashOptional ? '?' : ''}`;\r\n        break;\r\n      }\r\n      case TokenType.Static:\r\n        pattern += token.value.replace(REGEX_CHARS_RE, '\\\\$&');\r\n        if (nextToken && nextToken.type === TokenType.Pattern) {\r\n          pattern += `(.${nextToken.value})`;\r\n          keys.push(String(asteriskCount));\r\n          asteriskCount++;\r\n        }\r\n        scores.push(MatchScore.static);\r\n        break;\r\n      case TokenType.Param: {\r\n        // 动态参数支持形如/:param、/:param*、/:param?、/:param(\\\\d+)的形式\r\n        let paramRegexp = '';\r\n        if (nextToken) {\r\n          switch (nextToken.type) {\r\n            case TokenType.LBracket:\r\n              // 跳过当前Token和左括号\r\n              tokenIdx += 2;\r\n              while (tokens[tokenIdx].type !== TokenType.RBracket) {\r\n                paramRegexp += tokens[tokenIdx].value;\r\n                tokenIdx++;\r\n              }\r\n              paramRegexp = `(${paramRegexp})`;\r\n              break;\r\n            case TokenType.Pattern:\r\n              tokenIdx++;\r\n              paramRegexp += `(${nextToken.value === '*' ? '.*' : BASE_PARAM_PATTERN})${nextToken.value}`;\r\n              break;\r\n          }\r\n        }\r\n        pattern += paramRegexp ? `(?:${paramRegexp})` : `(${BASE_PARAM_PATTERN})`;\r\n        keys.push(token.value);\r\n        scores.push(MatchScore.param);\r\n        break;\r\n      }\r\n      case TokenType.WildCard:\r\n        keys.push(token.value);\r\n        pattern += `((?:${BASE_PARAM_PATTERN})${onlyHasWildCard ? '?' : ''}(?:/(?:${BASE_PARAM_PATTERN}))*)`;\r\n        scores.push(onlyHasWildCard ? MatchScore.wildcard : MatchScore.placeholder);\r\n        break;\r\n    }\r\n  }\r\n  const isWildCard = lastToken.type === TokenType.WildCard;\r\n\r\n  if (!isWildCard && !exact) {\r\n    if (!strictMode) {\r\n      pattern += `(?:[${escapeStr(DefaultDelimiter)}](?=$))?`;\r\n    }\r\n    if (lastToken.type !== TokenType.Delimiter) {\r\n      pattern += `(?=[${escapeStr(DefaultDelimiter)}]|$)`;\r\n    }\r\n  } else {\r\n    pattern += strictMode ? '$' : `[${escapeStr(DefaultDelimiter)}]?$`;\r\n  }\r\n\r\n  const flag = caseSensitive ? '' : 'i';\r\n  const regexp = new RegExp(pattern, flag);\r\n\r\n  /**\r\n   * @description 根据给定Pattern解析path\r\n   */\r\n  function parse(path: string): Matched<P> | null {\r\n    const reMatch = path.match(regexp);\r\n\r\n    if (!reMatch) {\r\n      return null;\r\n    }\r\n    const matchedPath = reMatch[0];\r\n    const params: Params<P> = {};\r\n    const parseScore: number[] = Array.from(scores);\r\n    for (let i = 1; i < reMatch.length; i++) {\r\n      const param = reMatch[i];\r\n      const key = keys[i - 1];\r\n      if (key === '*' && param) {\r\n        const value = param.split('/');\r\n        if (!Array.isArray(params['*'])) {\r\n          params['*'] = value;\r\n        } else {\r\n          params['*'].push(...value);\r\n        }\r\n        // 完成通配符参数解析后将placeholder替换为wildcard参数的分值\r\n        parseScore.splice(\r\n          scores.indexOf(MatchScore.placeholder),\r\n          1,\r\n          ...new Array(value.length).fill(MatchScore.wildcard)\r\n        );\r\n      } else {\r\n        params[key] = param ? param : undefined;\r\n      }\r\n    }\r\n\r\n    const isExact = path === matchedPath;\r\n    const url = path === '/' && matchedPath === '' ? '/' : matchedPath;\r\n    return { isExact: isExact, path: pathname, url: url, score: parseScore, params: params };\r\n  }\r\n\r\n  /**\r\n   * @description 使用给定参数填充pattern，得到目标URL\r\n   */\r\n  function compile(params: Params<P>): string {\r\n    let path = '';\r\n    for (const token of tokens) {\r\n      switch (token.type) {\r\n        case TokenType.Static:\r\n          path += token.value;\r\n          break;\r\n        case TokenType.Param:\r\n          if (!params[token.value]) {\r\n            throw new Error('Param is invalid.');\r\n          }\r\n          path += params[token.value];\r\n          break;\r\n        case TokenType.WildCard: {\r\n          const wildCard = params['*'];\r\n          if (wildCard instanceof Array) {\r\n            path += wildCard.join('/');\r\n          } else {\r\n            path += wildCard;\r\n          }\r\n          break;\r\n        }\r\n        case TokenType.Delimiter:\r\n          path += token.value;\r\n          break;\r\n      }\r\n    }\r\n    return path;\r\n  }\r\n\r\n  return {\r\n    regexp: regexp,\r\n    keys: keys,\r\n    score: scores,\r\n    compile,\r\n    parse,\r\n  };\r\n}\r\n\r\n/**\r\n * @description 依次使用pathname与pattern进行匹配，根据匹配分数取得分数最高结果\r\n */\r\nexport function matchPath<P = any>(\r\n  pathname: string,\r\n  pattern: string | string[],\r\n  option?: ParserOption\r\n): Matched<P> | null {\r\n  const patterns = Array.isArray(pattern) ? [...pattern] : [pattern];\r\n  const matchedResults: Matched<P>[] = [];\r\n  for (const item of patterns) {\r\n    const parser = createPathParser(item, option);\r\n    const matched = parser.parse(pathname);\r\n    if (matched) {\r\n      matchedResults.push(matched);\r\n    }\r\n  }\r\n  return !matchedResults.length ? null : matchedResults.sort((a, b) => scoreCompare(a.score, b.score))[0];\r\n}\r\n\r\nexport function generatePath<P = any>(path: string, params: Params<P>) {\r\n  const parser = createPathParser(path);\r\n  return parser.compile(params);\r\n}\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { createPathParser } from './parser';\r\nimport { scoreCompare } from './utils';\r\nimport type { Parser, ParserOption } from './types';\r\n\r\ntype RouteRecordName = string | symbol;\r\n\r\ninterface AgnosticRouteRecord<T extends AgnosticRouteRecord<T>> {\r\n  path: string;\r\n  component?: unknown | undefined;\r\n  meta?: Record<string | number | symbol, unknown>;\r\n  strict?: boolean;\r\n  sensitive?: boolean;\r\n  name?: RouteRecordName;\r\n  children?: T[];\r\n}\r\n\r\nexport interface RouteBranch<T extends AgnosticRouteRecord<T>, R = T> {\r\n  path: T['path'];\r\n  score: number[];\r\n  component: T['component'];\r\n  key: string[];\r\n  regexp: RegExp;\r\n  parse: Parser<unknown>['parse'];\r\n  compile: Parser<unknown>['compile'];\r\n  parent?: RouteBranch<T, R>;\r\n  children: RouteBranch<T, R>[];\r\n  raw: R;\r\n}\r\n\r\ninterface CommonLocation {\r\n  path: string;\r\n  name?: string | symbol | null;\r\n  params: Param;\r\n}\r\n\r\ninterface MatcherOption {\r\n  strict?: boolean;\r\n  sensitive?: boolean;\r\n}\r\n\r\ntype Param = Record<string, string | string[]>;\r\n\r\nconst defaultMatcherOption: MatcherOption = {\r\n  strict: false,\r\n  sensitive: false,\r\n};\r\n\r\nfunction isRouteName(name: unknown): name is RouteRecordName {\r\n  return typeof name === 'string' || typeof name === 'undefined';\r\n}\r\n\r\nfunction getLocationParams(params: Param, keys: string[]): Param {\r\n  const newParams: Param = {};\r\n  for (const key of keys) {\r\n    if (key in params) {\r\n      newParams[key] = params[key];\r\n    }\r\n  }\r\n  return newParams;\r\n}\r\n\r\nfunction convertRecordToBranch<T extends AgnosticRouteRecord<T>, R extends AgnosticRouteRecord<T>>(\r\n  record: R,\r\n  option: ParserOption\r\n): RouteBranch<T, R> {\r\n  const parser = createPathParser(record.path, option);\r\n  return {\r\n    raw: record,\r\n    path: record.path,\r\n    score: parser.score,\r\n    parse: parser.parse,\r\n    regexp: parser.regexp,\r\n    compile: parser.compile,\r\n    component: record.component,\r\n    key: parser.keys,\r\n    children: [],\r\n  };\r\n}\r\n\r\nfunction agnosticRouteMatcher<T extends AgnosticRouteRecord<T>, R extends AgnosticRouteRecord<T> = T>(\r\n  routes: T[],\r\n  option: MatcherOption = defaultMatcherOption,\r\n  branchHandler: (item: T) => R = item => item as unknown as R\r\n) {\r\n  const branches: RouteBranch<T, R>[] = [];\r\n  const branchesMap = new Map<RouteRecordName, RouteBranch<T, R>>();\r\n\r\n  function addBranch(route: T, parent: RouteBranch<T, R> | null = null, recursive: boolean = true) {\r\n    const normalizedRecord = branchHandler(route);\r\n    const path = normalizedRecord.path!;\r\n    if (parent && !path.startsWith('/')) {\r\n      const concatSlash = parent.path.endsWith('/') ? '' : '/';\r\n      normalizedRecord.path = parent.path + (path ? concatSlash + path : '');\r\n    }\r\n    const recordParserOption = mergeDefault(\r\n      {\r\n        exact: true,\r\n        caseSensitive: option.sensitive,\r\n        strictMode: option.strict,\r\n      },\r\n      {\r\n        caseSensitive: route.sensitive,\r\n        strictMode: route.strict,\r\n      }\r\n    );\r\n    const branch = convertRecordToBranch<T, R>(normalizedRecord, recordParserOption);\r\n    if (parent) {\r\n      branch.parent = parent;\r\n      parent.children.push(branch);\r\n    }\r\n    const originalBranch = branch;\r\n    branches.push(branch);\r\n    if (branch.raw.name) {\r\n      branchesMap.set(branch.raw.name, branch);\r\n    }\r\n    if (Array.isArray(route.children) && recursive) {\r\n      for (const child of route.children) {\r\n        addBranch(child, branch);\r\n      }\r\n    }\r\n    branches.sort((a, b) => {\r\n      const score = scoreCompare(a.score, b.score);\r\n      if (score !== 0) {\r\n        return score;\r\n      }\r\n      return a.parent ? -1 : 1;\r\n    });\r\n    return originalBranch ? () => delBranch(originalBranch) : () => {};\r\n  }\r\n\r\n  function getNamedBranch(name: RouteRecordName) {\r\n    if (branchesMap.has(name)) {\r\n      return branchesMap.get(name)!.raw;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  function delBranch(branchRef: RouteRecordName | RouteBranch<T, R>) {\r\n    if (isRouteName(branchRef)) {\r\n      const branch = branchesMap.get(branchRef);\r\n      if (branch) {\r\n        branchesMap.delete(branchRef);\r\n        const branchIndex = branches.indexOf(branch);\r\n        if (branchIndex > -1) {\r\n          branches.splice(branchIndex, 1);\r\n          branch.children.forEach(b => delBranch(b));\r\n        }\r\n      }\r\n    } else {\r\n      const idx = branches.indexOf(branchRef);\r\n      if (idx > -1) {\r\n        branches.splice(idx, 1);\r\n        if (branchRef.raw.name) {\r\n          branchesMap.delete(branchRef.raw.name);\r\n        }\r\n      }\r\n      branchRef.children.forEach(b => delBranch(b));\r\n    }\r\n    branches.sort((a, b) => scoreCompare(a.score, b.score));\r\n  }\r\n\r\n  function matchPath(to: Readonly<Partial<CommonLocation>>, from: Readonly<CommonLocation>) {\r\n    let path: RouteBranch<T, R>['path'];\r\n    let branch: RouteBranch<T, R> | undefined;\r\n    let name: RouteRecordName | undefined;\r\n    let params: Param = {};\r\n\r\n    if ('name' in to && to.name) {\r\n      branch = branchesMap.get(to.name);\r\n      if (!branch) {\r\n        throw Error('route now found');\r\n      }\r\n      name = branch.raw.name;\r\n      params = getLocationParams(from.params, branch.key);\r\n      if (to.params) {\r\n        params = Object.assign(params, getLocationParams(to.params, branch.key));\r\n      }\r\n      path = branch.compile(params);\r\n    } else if (to.path != null) {\r\n      path = to.path;\r\n      for (const b of branches) {\r\n        if (b.regexp.test(path)) {\r\n          branch = b;\r\n          break;\r\n        }\r\n      }\r\n      if (branch) {\r\n        params = branch.parse(path)!.params;\r\n        name = branch.raw.name;\r\n      }\r\n    } else {\r\n      branch = from.name ? branchesMap.get(from.name) : branches.find(b => b.regexp.test(from.path));\r\n      if (!branch) {\r\n        throw Error('route now found');\r\n      }\r\n      name = branch.raw.name;\r\n      params = Object.assign({}, from.params, to.params);\r\n      path = branch.compile(params);\r\n    }\r\n    const matched: R[] = [];\r\n    let parentBranch = branch;\r\n    while (parentBranch) {\r\n      matched.push(parentBranch.raw);\r\n      parentBranch = parentBranch.parent;\r\n    }\r\n    // push is 800 times faster than unshift\r\n    matched.reverse();\r\n    if (matched.length < 1) {\r\n      console.warn(`url \"${path}\" has no matched route`);\r\n    }\r\n\r\n    return {\r\n      name,\r\n      path,\r\n      params,\r\n      matched,\r\n      meta: merge(matched),\r\n    };\r\n  }\r\n\r\n  routes.forEach(r => addBranch(r));\r\n\r\n  return {\r\n    branches,\r\n    addBranch,\r\n    delBranch,\r\n    matchPath,\r\n    getNamedBranch,\r\n  };\r\n}\r\n\r\ntype RecordMeta = Pick<AgnosticRouteRecord<any>, 'meta'>;\r\n\r\nfunction merge<T extends RecordMeta>(data: T[]) {\r\n  return data.reduce((prev, currentValue) => Object.assign(prev, currentValue.meta), {});\r\n}\r\n\r\nfunction mergeDefault<T extends { [key: string]: any }>(defaultOptions: T, partialOptions: Partial<T>): T {\r\n  const mergedOption = {} as T;\r\n  for (const key in defaultOptions) {\r\n    mergedOption[key] =\r\n      key in partialOptions && partialOptions[key] != null ? partialOptions[key]! : defaultOptions[key];\r\n  }\r\n  return mergedOption;\r\n}\r\n\r\nexport { agnosticRouteMatcher };\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { MatcherLocation, RouteLocation, type RouteLocationRaw } from './types';\r\nimport { ErrorTypes } from './const';\r\n\r\nexport interface MatcherError extends Error {\r\n  type: ErrorTypes.MATCHER_NOT_FOUND;\r\n  location: MatcherLocation;\r\n  currentLocation?: MatcherLocation;\r\n}\r\n\r\nexport interface NavigationFailure extends Error {\r\n  type: ErrorTypes.NAVIGATION_CANCELLED | ErrorTypes.NAVIGATION_ABORTED | ErrorTypes.NAVIGATION_DUPLICATED;\r\n  from: RouteLocation;\r\n  to: RouteLocation;\r\n}\r\n\r\nexport interface NavigationRedirectError extends Omit<NavigationFailure, 'to' | 'type'> {\r\n  type: ErrorTypes.NAVIGATION_GUARD_REDIRECT;\r\n  to: RouteLocationRaw;\r\n}\r\n\r\nexport type RouteError = MatcherError | NavigationFailure | NavigationRedirectError;\r\n\r\nconst NavigationFailureSymbol = Symbol('navigation failure');\r\n\r\nexport function createRouterError<T extends RouteError>(type: T['type'], params: Omit<T, 'type' | keyof Error>): T {\r\n  return Object.assign(new Error(), { type: type, [NavigationFailureSymbol]: true }, params) as unknown as T;\r\n}\r\n\r\nexport function isNavigationFailure(error: any, type: ErrorTypes) {\r\n  return (\r\n    error instanceof Error &&\r\n    NavigationFailureSymbol in error &&\r\n    (type == null || Boolean((error as unknown as NavigationFailure).type & type))\r\n  );\r\n}\r\n","import toPropertyKey from \"./toPropertyKey.js\";\nexport default function _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { useContext, useEffect, useMemo, useRef } from '@cloudsop/horizon';\r\nimport { RouteContext, RouterContext } from './RouterContext';\r\nimport { guardEvent, includesParams, isSameRouteLocation } from './utils';\r\nimport type { RouterLinkProps } from './RouterLink';\r\nimport type { NavigationFailure } from './routerError';\r\nimport type { RouteLocation } from './types';\r\nimport type { VueRouterInternal } from './Router';\r\n\r\nfunction useRouter() {\r\n  return useContext(RouterContext);\r\n}\r\n\r\nfunction useRoute() {\r\n  return useContext(RouteContext);\r\n}\r\n\r\nfunction useLink(props: Pick<RouterLinkProps, 'to' | 'replace'>) {\r\n  const router = useContext(RouterContext);\r\n  const currentRoute = useContext(RouteContext);\r\n\r\n  const { to, replace } = props;\r\n\r\n  const route = useMemo(() => router.resolve(to), [to]);\r\n\r\n  const activeBranchIndex = useMemo<number>(() => {\r\n    const matched = route.matched;\r\n    const length = matched.length;\r\n\r\n    const targetMatched = matched[length - 1];\r\n    const currentMatched = currentRoute.matched;\r\n    if (!targetMatched || currentMatched.length === 0) {\r\n      return -1;\r\n    }\r\n    const index = currentMatched.findIndex(m => m === targetMatched);\r\n    if (index > -1) {\r\n      return index;\r\n    }\r\n    const parentRecordPath: string = matched[length - 2] ? matched[length - 2].path : '';\r\n\r\n    if (\r\n      length > 1 &&\r\n      targetMatched.path === parentRecordPath &&\r\n      currentMatched[currentMatched.length - 1].path !== parentRecordPath\r\n    ) {\r\n      return currentMatched.findIndex(m => m === matched[length - 2]);\r\n    }\r\n    return index;\r\n  }, [route, currentRoute]);\r\n\r\n  const isActive = activeBranchIndex > -1 && includesParams(currentRoute.params, route.params);\r\n  const isExactActive =\r\n    activeBranchIndex > -1 &&\r\n    activeBranchIndex === currentRoute.matched.length - 1 &&\r\n    isSameRouteLocation(currentRoute, route);\r\n\r\n  function navigate(e: MouseEvent): Promise<void | NavigationFailure> {\r\n    if (guardEvent(e)) {\r\n      return router[replace ? 'replace' : 'push'](to);\r\n    }\r\n    return Promise.resolve();\r\n  }\r\n\r\n  return {\r\n    route,\r\n    navigate,\r\n    isActive,\r\n    isExactActive,\r\n  };\r\n}\r\n\r\ninterface WatchCallback {\r\n  (newRouteLocation: RouteLocation, oldRouteLocation: RouteLocation): void;\r\n}\r\n\r\ninterface WatchConfig {\r\n  immediate: boolean;\r\n}\r\n\r\nfunction useRouteWatch(callback: WatchCallback, config?: WatchConfig): () => void {\r\n  const router = useContext(RouterContext) as VueRouterInternal;\r\n  const { immediate } = config || {};\r\n  const isMount = useRef(false);\r\n  const unListener = useRef<(() => void) | null>(null);\r\n  useEffect(() => {\r\n    if (!isMount.current) {\r\n      unListener.current = router.subscribeRouteChange((to, from) => callback(to, from));\r\n      if (immediate) {\r\n        callback(router.currentRoute, router.currentRoute);\r\n      }\r\n      isMount.current = true;\r\n    }\r\n  }, []);\r\n  return () => unListener.current && unListener.current();\r\n}\r\n\r\nexport { useRouter, useRoute, useLink, useRouteWatch };\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { InulaNode, useContext } from '@cloudsop/horizon';\r\nimport { RouterContext } from './RouterContext';\r\nimport { useLink } from './hooks';\r\n\r\nconst getLinkClass = (propClass: string | undefined, globalClass: string | undefined, defaultClass: string): string => {\r\n  return [propClass, globalClass, defaultClass].reduce((prev, curr) => {\r\n    return prev != null ? prev : curr;\r\n  }) as string;\r\n};\r\n\r\nexport interface RouterLinkProps {\r\n  to: string;\r\n  replace?: boolean;\r\n  activeClass?: string;\r\n  exactActiveClass?: string;\r\n  children?: InulaNode;\r\n\r\n  [key: string]: any;\r\n}\r\n\r\nfunction RouterLink(props: RouterLinkProps) {\r\n  const router = useContext(RouterContext);\r\n  const { to, replace, children } = props;\r\n  const link = useLink({ to, replace });\r\n  const { activeClass, exactActiveClass } = props;\r\n  const { linkActiveClass, linkExactActiveClass } = router.option;\r\n\r\n  const classes: string[] = [];\r\n  if (link.isActive) {\r\n    classes.push(getLinkClass(activeClass, linkActiveClass, 'router-link-active'));\r\n  }\r\n  if (link.isExactActive) {\r\n    classes.push(getLinkClass(exactActiveClass, linkExactActiveClass, 'router-link-exact-active'));\r\n  }\r\n\r\n  const className: string | undefined = classes.length > 0 ? classes.join(' ') : undefined;\r\n\r\n  return (\r\n    <a onClick={link.navigate} href={link.route.fullPath} className={className}>\r\n      {children}\r\n    </a>\r\n  );\r\n}\r\n\r\nexport default RouterLink;\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { createElement, useContext, useMemo } from '@cloudsop/horizon';\r\nimport { CurrentRouteRecord, RouteContext, ViewDepth } from './RouterContext';\r\nimport { NormalizedRouteRecord } from './types';\r\n\r\nfunction calcNextDepth(currentDepth: number, matched: NormalizedRouteRecord[]) {\r\n  let matchedRecord: NormalizedRouteRecord | undefined;\r\n  let nextDepth = currentDepth;\r\n  while ((matchedRecord = matched[nextDepth]) && !matchedRecord.component) {\r\n    nextDepth++;\r\n  }\r\n  return nextDepth;\r\n}\r\n\r\nfunction RouterView() {\r\n  const { matched } = useContext(RouteContext);\r\n  const { depth } = useContext(ViewDepth);\r\n  const nextDepth = useMemo(() => calcNextDepth(depth, matched), [depth]);\r\n  const routeRecord = matched[nextDepth];\r\n  if (routeRecord) {\r\n    const { component, props } = routeRecord;\r\n    const nextComponent = createElement(component, props);\r\n\r\n    return (\r\n      <ViewDepth.Provider value={{ depth: nextDepth + 1 }}>\r\n        <CurrentRouteRecord.Provider value={routeRecord}>{nextComponent}</CurrentRouteRecord.Provider>\r\n      </ViewDepth.Provider>\r\n    );\r\n  }\r\n  return null;\r\n}\r\n\r\nexport default RouterView;\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport type { VueHistory } from './vueHistory';\r\nimport { ComponentType, createElement, FunctionComponent, InulaElement } from '@cloudsop/horizon';\r\nimport type {\r\n  ExceptListener,\r\n  NavigationGuard,\r\n  NavigationGuardNext,\r\n  NavigationHook,\r\n  NormalizedRouteRecord,\r\n  RouteLocation,\r\n  RouteLocationRaw,\r\n  RouteMetaData,\r\n  RouteRecordName,\r\n  RouteRedirectOption,\r\n} from './types';\r\nimport { agnosticRouteMatcher, RouteBranch } from '../matcher/matcher';\r\nimport { ErrorTypes, START_LOCATION } from './const';\r\nimport {\r\n  createCallBackList,\r\n  isSameRouteLocation,\r\n  locationToObject,\r\n  normalizeQuery,\r\n  parseURL,\r\n  stringifyUrl,\r\n} from './utils';\r\nimport { createRouterError, NavigationFailure } from './routerError';\r\nimport RouterLink from './RouterLink';\r\nimport RouterView from './RouterView';\r\nimport { RouterProvider } from './RouterProvider';\r\n\r\ninterface App {\r\n  rootComponent: InulaElement;\r\n\r\n  component(name: string, component: FunctionComponent<any>): void;\r\n\r\n  config: AppConfig;\r\n}\r\n\r\ninterface AppConfig {\r\n  globalProperties: Record<string, any>;\r\n}\r\n\r\nexport interface VueRouter {\r\n  readonly currentRoute: RouteLocation;\r\n\r\n  readonly option: RouterOptions;\r\n\r\n  listening: boolean;\r\n\r\n  // dynamic operate route methods\r\n  addRoute(route: RouteRecord): () => void;\r\n\r\n  removeRoute(name: RouteRecordName): void;\r\n\r\n  hasRoute(name: RouteRecordName): boolean;\r\n\r\n  getRoutes(): RouteBranch<RouteRecord, NormalizedRouteRecord>[];\r\n\r\n  resolve(to: Readonly<RouteLocationRaw>, from?: Readonly<RouteLocation>): RouteLocation;\r\n\r\n  // negative methods\r\n  push(to: RouteLocationRaw): Promise<NavigationFailure | void | undefined>;\r\n\r\n  replace(to: RouteLocationRaw): Promise<NavigationFailure | void | undefined>;\r\n\r\n  go(delta: number): void;\r\n\r\n  back(): void;\r\n\r\n  forward(): void;\r\n\r\n  // hooks\r\n  beforeEach(guard: NavigationGuard): () => void;\r\n\r\n  beforeResolve(guard: NavigationGuard): () => void;\r\n\r\n  afterEach(guard: NavigationHook): () => void;\r\n\r\n  onError(handler: ExceptListener): () => void;\r\n\r\n  // status\r\n  isReady(): Promise<void>;\r\n\r\n  install(app: App): void;\r\n}\r\n\r\nexport interface VueRouterInternal extends VueRouter {\r\n  // trigger when popstate event\r\n  pop(to: RouteLocationRaw): void;\r\n\r\n  // use for RouterProvider\r\n  subscribeRouteChange(observer: RouteObserver): () => void;\r\n}\r\n\r\ninterface RouterMatchOption {\r\n  sensitive?: boolean;\r\n  strict?: boolean;\r\n  start?: boolean;\r\n  end?: boolean;\r\n}\r\n\r\ntype RouteRecordOption = Omit<RouterMatchOption, 'start' | 'end'>;\r\n\r\nexport interface RouteRecordBase extends RouteRecordOption {\r\n  path: string;\r\n  redirect?: RouteRedirectOption;\r\n  alias?: string | string[];\r\n  name?: RouteRecordName;\r\n  meta?: RouteMetaData;\r\n  children?: unknown[];\r\n  props?: boolean | Record<string, unknown>;\r\n  beforeEnter?: NavigationGuard | NavigationGuard[];\r\n}\r\n\r\nexport interface RouteRecordSingleView extends RouteRecordBase {\r\n  component: ComponentType<any>;\r\n  children?: never;\r\n}\r\n\r\nexport interface RouteRecordWithChildren extends RouteRecordBase {\r\n  component: ComponentType<any>;\r\n  children: RouteRecord[];\r\n}\r\n\r\nexport interface RouteRecordRedirect extends RouteRecordBase {\r\n  redirect?: RouteRedirectOption;\r\n  component?: never;\r\n  props?: never;\r\n  children?: never;\r\n}\r\n\r\nexport type RouteRecord = RouteRecordSingleView | RouteRecordWithChildren | RouteRecordRedirect;\r\n\r\nexport type Guard<T = any> = () => Promise<T>;\r\n\r\nexport interface RouteObserver {\r\n  (to: RouteLocation, from: RouteLocation): void;\r\n}\r\n\r\nexport interface RouterOptions extends RouteRecordOption {\r\n  history: VueHistory;\r\n  routes: RouteRecord[];\r\n  linkActiveClass?: string;\r\n  linkExactActiveClass?: string;\r\n}\r\n\r\nfunction normalizeRouteRecord(record: RouteRecord): NormalizedRouteRecord {\r\n  return {\r\n    beforeEnter: record.beforeEnter,\r\n    children: record.children || [],\r\n    component: record.component,\r\n    leaveGuards: new Set<NavigationGuard>(),\r\n    meta: record.meta || {},\r\n    name: record.name,\r\n    path: record.path,\r\n    props: record.props || {},\r\n    redirected: record.redirect,\r\n    updateGuards: new Set<NavigationGuard>(),\r\n  };\r\n}\r\n\r\nfunction initRouter(options: RouterOptions): VueRouterInternal {\r\n  const { history, routes } = options;\r\n\r\n  const matcher = agnosticRouteMatcher<RouteRecord, NormalizedRouteRecord>(\r\n    routes,\r\n    {\r\n      sensitive: options.sensitive,\r\n      strict: options.strict,\r\n    },\r\n    item => normalizeRouteRecord(item)\r\n  );\r\n\r\n  const beforeEachGuards = createCallBackList<NavigationGuard>();\r\n  const beforeResolveGuards = createCallBackList<NavigationGuard>();\r\n  const afterEachGuards = createCallBackList<NavigationHook>();\r\n  const exceptListeners = createCallBackList<ExceptListener>();\r\n\r\n  const observers = createCallBackList<RouteObserver>();\r\n\r\n  function resolve(to: Readonly<RouteLocationRaw>, from?: Readonly<RouteLocation>): RouteLocation {\r\n    from = Object.assign({}, from || router.currentRoute);\r\n    if (typeof to === 'string') {\r\n      const normalizedLocation = parseURL(to, from.path);\r\n      const matchedRoute = matcher.matchPath({ path: normalizedLocation.path }, from);\r\n      return Object.assign(normalizedLocation, matchedRoute);\r\n    }\r\n\r\n    let matcherLocation;\r\n\r\n    if (to.path != null) {\r\n      matcherLocation = Object.assign({}, to, { path: parseURL(to.path, from.path).path });\r\n    } else {\r\n      const targetParams = Object.assign({}, to.params);\r\n      for (const key of Object.keys(targetParams)) {\r\n        if (targetParams[key] == null) {\r\n          delete targetParams[key];\r\n        }\r\n      }\r\n      matcherLocation = Object.assign({}, to, { params: targetParams });\r\n    }\r\n    const matchedRoute = matcher.matchPath(matcherLocation, from);\r\n    const fullPath = stringifyUrl(Object.assign(to, { path: matchedRoute.path }));\r\n    const query = normalizeQuery(to.query);\r\n    const hash = to.hash || '';\r\n    return Object.assign({ fullPath, query, hash }, matchedRoute);\r\n  }\r\n\r\n  async function push(to: RouteLocationRaw, redirectFrom?: RouteLocation) {\r\n    const replace = typeof to === 'string' ? false : to.replace;\r\n    const force = typeof to === 'string' ? false : to.force;\r\n    const target = router.resolve(to);\r\n    const from = router.currentRoute;\r\n\r\n    const redirectLocation = extractRedirect(target);\r\n    if (redirectLocation) {\r\n      return push(Object.assign(redirectLocation, { replace: to, force: force }), redirectFrom || target);\r\n    }\r\n\r\n    target.redirectedFrom = redirectFrom;\r\n    let failure: NavigationFailure | void | undefined;\r\n    if (!force && isSameRouteLocation(target, from)) {\r\n      failure = createRouterError<NavigationFailure>(ErrorTypes.NAVIGATION_DUPLICATED, { to: target, from });\r\n    }\r\n\r\n    return failure\r\n      ? Promise.resolve(failure)\r\n      : triggerGuards(target, from)\r\n          .catch(err => triggerError(err, target, from))\r\n          .then((failure: NavigationFailure | void) => {\r\n            if (failure) {\r\n              Promise.reject('infinite redirect in navigation guard');\r\n            } else {\r\n              doNavigate(target, true, replace);\r\n            }\r\n            triggerAfterEach(target, from);\r\n          });\r\n  }\r\n\r\n  function replace(to: RouteLocationRaw) {\r\n    const dest = typeof to === 'string' ? parseURL(to) : to;\r\n    return push(Object.assign(dest, { replace: true }));\r\n  }\r\n\r\n  function extractRedirect(to: Readonly<RouteLocation>): RouteLocationRaw | null {\r\n    const lastMatched = to.matched[to.matched.length - 1];\r\n    if (lastMatched && lastMatched.redirected) {\r\n      const redirect = lastMatched.redirected;\r\n      let newTarget = typeof redirect === 'function' ? redirect(to) : redirect;\r\n      if (typeof newTarget === 'string') {\r\n        if (newTarget.includes('?') || newTarget.includes('#')) {\r\n          newTarget = locationToObject(newTarget, router.currentRoute);\r\n        } else {\r\n          newTarget = { path: newTarget };\r\n        }\r\n      }\r\n      return Object.assign(\r\n        {\r\n          query: to.query,\r\n          hash: to.hash,\r\n          params: newTarget.path != null ? {} : to.params,\r\n        },\r\n        newTarget\r\n      );\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async function pop(to: RouteLocationRaw) {\r\n    const target = router.resolve(to);\r\n    const from = router.currentRoute;\r\n    return triggerGuards(target, from)\r\n      .catch(error => {\r\n        return triggerError(error, target, from);\r\n      })\r\n      .then((failure: NavigationFailure | void) => {\r\n        doNavigate(target, false);\r\n        triggerAfterEach(target, from, failure);\r\n      })\r\n      .catch();\r\n  }\r\n\r\n  async function triggerGuards(to: RouteLocation, from: RouteLocation) {\r\n    let guards: Guard[] = [];\r\n    const { leavingRecords, updateRecords, enterRecords } = analyseChangingRecord(to, from);\r\n\r\n    for (const record of leavingRecords) {\r\n      record.leaveGuards.forEach(guard => {\r\n        guards.push(guardToPromise(guard, to, from));\r\n      });\r\n    }\r\n\r\n    return runGuardQueue(guards)\r\n      .then(() => {\r\n        guards = [];\r\n        for (const beforeEachGuard of beforeEachGuards.list()) {\r\n          guards.push(guardToPromise(beforeEachGuard, to, from));\r\n        }\r\n        return runGuardQueue(guards);\r\n      })\r\n      .then(() => {\r\n        guards = [];\r\n        for (const record of updateRecords) {\r\n          record.updateGuards.forEach(guard => {\r\n            guards.push(guardToPromise(guard, to, from));\r\n          });\r\n        }\r\n        return runGuardQueue(guards);\r\n      })\r\n      .then(() => {\r\n        guards = [];\r\n        for (const record of enterRecords) {\r\n          if (record.beforeEnter) {\r\n            if (Array.isArray(record.beforeEnter)) {\r\n              const beforeEnters = record.beforeEnter.map(r => guardToPromise(r, to, from));\r\n              guards = guards.concat(beforeEnters);\r\n            } else {\r\n              guards.push(guardToPromise(record.beforeEnter, to, from));\r\n            }\r\n          }\r\n        }\r\n        return runGuardQueue(guards);\r\n      })\r\n      .then(() => {\r\n        guards = [];\r\n        for (const guard of beforeResolveGuards.list()) {\r\n          guards.push(guardToPromise(guard, to, from));\r\n        }\r\n        return runGuardQueue(guards);\r\n      })\r\n      .catch(err => {\r\n        Promise.reject(err);\r\n      });\r\n  }\r\n\r\n  function doNavigate(to: RouteLocation, triggerHistory?: boolean, replace?: boolean) {\r\n    if (triggerHistory) {\r\n      if (replace) {\r\n        history.replace(to.fullPath);\r\n      } else {\r\n        history.push(to.fullPath);\r\n      }\r\n    }\r\n    notifyUpdate({ currentRoute: to });\r\n  }\r\n\r\n  function triggerAfterEach(to: RouteLocation, from: RouteLocation, failure?: NavigationFailure | void): void {\r\n    afterEachGuards.list().forEach(guard => guard(to, from, failure));\r\n  }\r\n\r\n  function triggerError(error: any, to: RouteLocation, from: RouteLocation) {\r\n    for (const trigger of exceptListeners.list()) {\r\n      trigger(error, to, from);\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n\r\n  function notifyUpdate(newAttrs: Partial<VueRouter>) {\r\n    if ('currentRoute' in newAttrs) {\r\n      const prevLocation = router.currentRoute;\r\n      Object.assign(router, newAttrs);\r\n      observers.list().forEach(trigger => {\r\n        trigger(router.currentRoute, prevLocation);\r\n      });\r\n    }\r\n  }\r\n\r\n  function install(app: App) {\r\n    // wrap RouterProvider for App\r\n    app.component('RouterLink', RouterLink);\r\n    app.component('RouterView', RouterView);\r\n    const routerInstance = initRouter(options);\r\n    app.rootComponent = createElement(RouterProvider, { router: routerInstance }, app.rootComponent);\r\n    app.config.globalProperties.$router = routerInstance;\r\n    Object.defineProperty(app.config.globalProperties, '$route', {\r\n      enumerable: true,\r\n      get: () => routerInstance.currentRoute,\r\n    });\r\n  }\r\n\r\n  function subscribeRouteChange(observer: RouteObserver) {\r\n    return observers.add(observer);\r\n  }\r\n\r\n  const router: VueRouterInternal = {\r\n    currentRoute: START_LOCATION,\r\n    option: options,\r\n    listening: true,\r\n    go: history.go,\r\n    back: () => history.go(-1),\r\n    forward: () => history.go(1),\r\n    push: push,\r\n    pop: pop,\r\n    replace: replace,\r\n    resolve: resolve,\r\n    beforeEach: beforeEachGuards.add,\r\n    beforeResolve: beforeResolveGuards.add,\r\n    afterEach: afterEachGuards.add,\r\n    onError: exceptListeners.add,\r\n    addRoute(route: RouteRecord): () => void {\r\n      return matcher.addBranch(route);\r\n    },\r\n    removeRoute(name: RouteRecordName) {\r\n      return matcher.delBranch(name);\r\n    },\r\n    hasRoute(name: RouteRecordName): boolean {\r\n      return Boolean(matcher.getNamedBranch(name));\r\n    },\r\n    getRoutes(): RouteBranch<RouteRecord, NormalizedRouteRecord>[] {\r\n      return matcher.branches;\r\n    },\r\n    isReady(): Promise<void> {\r\n      return Promise.resolve();\r\n    },\r\n    install: install,\r\n    subscribeRouteChange,\r\n  };\r\n\r\n  return router;\r\n}\r\n\r\nfunction analyseChangingRecord(to: RouteLocation, from: RouteLocation) {\r\n  const leavingRecords: NormalizedRouteRecord[] = [];\r\n  const updateRecords: NormalizedRouteRecord[] = [];\r\n  const enterRecords: NormalizedRouteRecord[] = [];\r\n\r\n  const maxLen = Math.max(to.matched.length, from.matched.length);\r\n  for (let i = 0; i < maxLen; i++) {\r\n    const recordFrom = from.matched[i];\r\n    if (recordFrom) {\r\n      if (to.matched.find(m => m === recordFrom)) {\r\n        updateRecords.push(recordFrom);\r\n      } else {\r\n        leavingRecords.push(recordFrom);\r\n      }\r\n    }\r\n    const recordTo = to.matched[i];\r\n    if (recordTo) {\r\n      if (from.matched.findIndex(m => m === recordTo) === -1) {\r\n        enterRecords.push(recordTo);\r\n      }\r\n    }\r\n  }\r\n\r\n  return { leavingRecords, updateRecords, enterRecords };\r\n}\r\n\r\nfunction guardToPromise(guard: NavigationGuard, to: RouteLocation, from: RouteLocation): Guard {\r\n  const promise = new Promise((resolve, reject) => {\r\n    const next: NavigationGuardNext = (valid?: boolean | RouteLocationRaw | Error) => {\r\n      if (valid === false) {\r\n        reject(createRouterError(ErrorTypes.NAVIGATION_ABORTED, { from, to }));\r\n      } else if (valid instanceof Error) {\r\n        reject(valid);\r\n      } else if (typeof valid === 'string' || (valid && typeof valid === 'object')) {\r\n        reject(createRouterError(ErrorTypes.NAVIGATION_GUARD_REDIRECT, { from: to, to: valid }));\r\n      } else {\r\n        resolve(null);\r\n      }\r\n    };\r\n    const guardReturn = guard(to, from, next);\r\n    let guardCall = Promise.resolve(guardReturn);\r\n    if (guard.length < 3) {\r\n      guardCall = guardCall.then(next);\r\n    }\r\n    guardCall.catch(err => reject(err));\r\n  });\r\n\r\n  return () => promise;\r\n}\r\n\r\nfunction runGuardQueue(guards: Guard[]) {\r\n  return guards.reduce((promise, guard) => promise.then(() => guard()), Promise.resolve());\r\n}\r\n\r\nexport { initRouter };\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { InulaNode, useLayoutEffect, useRef, useState } from '@cloudsop/horizon';\r\nimport { RouteContext, RouterContext } from './RouterContext';\r\nimport { initRouter, RouterOptions, VueRouter, VueRouterInternal } from './Router';\r\nimport { parseURL } from './utils';\r\nimport { RouteLocation } from './types';\r\n\r\ninterface RouterProviderProps {\r\n  router: VueRouter;\r\n  children: InulaNode;\r\n}\r\n\r\nexport function createRouter(option: RouterOptions): VueRouter {\r\n  return initRouter(option);\r\n}\r\n\r\nexport function RouterProvider(props: RouterProviderProps) {\r\n  const { children } = props;\r\n  const router = props.router as VueRouterInternal;\r\n  const {\r\n    currentRoute,\r\n    option: { history },\r\n  } = router;\r\n\r\n  const unListen = useRef<(() => void) | null>(null);\r\n  const isMount = useRef(false);\r\n  const detachObserver = useRef<(() => void) | null>(null);\r\n\r\n  const urlLocation = parseURL(history.location);\r\n  const [location, setLocation] = useState<RouteLocation>(currentRoute);\r\n\r\n  if (!detachObserver.current) {\r\n    detachObserver.current = router.subscribeRouteChange(to => {\r\n      setLocation(to);\r\n    });\r\n  }\r\n\r\n  // trigger navigator guards when first entry page\r\n  if (location.fullPath !== urlLocation.fullPath || !isMount.current) {\r\n    void router.push(history.location);\r\n  }\r\n\r\n  useLayoutEffect(() => {\r\n    isMount.current = true;\r\n    if (unListen.current) {\r\n      unListen.current();\r\n    }\r\n    if (detachObserver.current) {\r\n      detachObserver.current();\r\n    }\r\n\r\n    detachObserver.current = router.subscribeRouteChange(to => {\r\n      setLocation(to);\r\n    });\r\n\r\n    unListen.current = history.listen(to => {\r\n      if (isMount.current) {\r\n        router.pop(to);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      if (unListen.current) {\r\n        isMount.current = false;\r\n        unListen.current();\r\n        unListen.current = null;\r\n      }\r\n      if (detachObserver.current) {\r\n        detachObserver.current();\r\n        detachObserver.current = null;\r\n      }\r\n    };\r\n  });\r\n\r\n  return (\r\n    <RouterContext.Provider value={router}>\r\n      <RouteContext.Provider value={location}>{children}</RouteContext.Provider>\r\n    </RouterContext.Provider>\r\n  );\r\n}\r\n","/*\r\n * Copyright (c) 2020 Huawei Technologies Co.,Ltd.\r\n *\r\n * openInula is licensed under Mulan PSL v2.\r\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\r\n * You may obtain a copy of Mulan PSL v2 at:\r\n *\r\n *          http://license.coscl.org.cn/MulanPSL2\r\n *\r\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\r\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\r\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\r\n * See the Mulan PSL v2 for more details.\r\n */\r\n\r\nimport { NavigationGuard } from './types';\r\nimport { useContext, useLayoutEffect } from '@cloudsop/horizon';\r\nimport { CurrentRouteRecord } from './RouterContext';\r\n\r\nfunction onBeforeRouteLeave(leaveGuard: NavigationGuard) {\r\n  useRegisterGuards('leaveGuards', leaveGuard);\r\n}\r\n\r\nfunction onBeforeRouteUpdate(updateGuard: NavigationGuard) {\r\n  useRegisterGuards('updateGuards', updateGuard);\r\n}\r\n\r\ntype GuardType = 'leaveGuards' | 'updateGuards';\r\n\r\nfunction useRegisterGuards(name: GuardType, guard: NavigationGuard) {\r\n  const match = useContext(CurrentRouteRecord);\r\n\r\n  useLayoutEffect(() => {\r\n    match[name].add(guard);\r\n\r\n    return () => {\r\n      match[name].delete(guard);\r\n    };\r\n  }, []);\r\n\r\n  return null;\r\n}\r\n\r\nexport { onBeforeRouteLeave, onBeforeRouteUpdate };\r\n"],"names":["getDefaultConfirmation","message","callBack","window","confirm","isSupportHistory","document","createElement","history","isSupportsPopState","navigator","userAgent","indexOf","Action","EventType","PopDirection","_extends","Object","assign","bind","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","createPath","path","search","hash","pathname","startsWith","createLocation","current","to","state","end","urlObj","url","parsedPath","hashIdx","substring","searchIdx","parsePath","getRandKey","Math","random","toString","location","parseRelativePath","addHeadSlash","normalizeSlash","tempPath","stripBasename","prefix","toLowerCase","includes","charAt","hasBasename","from","fromParts","split","toParts","lastToPart","push","urlPart","index","toIndex","slice","join","_typeof","o","Symbol","iterator","constructor","toPropertyKey","t","r","e","toPrimitive","TypeError","String","Number","_defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","TransitionManager","instance","Constructor","_classCallCheck","prompt","protoProps","staticProps","value","_this","action","userConfirmationFunc","result","warning","condition","console","warn","createBrowserHistory","fn","visitedRecord","options","undefined","supportHistory","isSupportPopState","browserHistory","_options$forceRefresh","forceRefresh","_options$getUserConfi","getUserConfirmation","basename","initLocation","getLocation","getHistoryState","recordOperator","l","getDelta","toIdx","lastIndexOf","fromIdx","addRecord","newRecord","curVal","NewVal","prevIdx","newVisitedRecord","replace","transitionManager","_getBaseHistory","type","popActionListener","listenerCount","supportPopState","listeners","unListeners","pauseTrigger","setupListener","count","addEventListener","PopState","HashChange","removeEventListener","isBlocked","go","step","addListener","listener","isActive","trigger","args","information","cancelListener","filter","block","unblock","setPrompt","destroy","_step","_iterator","_createForOfIteratorHelper","s","n","done","unListen","err","f","getUpdateStateFunc","historyProps","nextState","originPath","delta","commonArgs","popArgs","direction","forward","back","pop","getBaseHistory","event","historyState","isEventPopState","forceJump","updateState","callback","isJump","confirmJumpTo","handlePopState","locationHandler","goBack","goForward","listen","href","createHref","pushState","replaceState","_window$location","_ref","baseHandler","BEFORE_HASH_RE","createHrefHandler","base","parseURL","params","text","currentLocation","query","searchString","hashPos","searchPos","URLSearchParams","fromEntries","entries","fullPath","decodeURIComponent","stringifyQuery","urlParams","keys","_loop","_keys","_i","Array","isArray","forEach","v","append","shallowCompareArray","a","b","every","isSameRouteLocation","matchLengthA","matched","matchLengthB","aKeys","bKeys","_i2","_aKeys","aValue","bValue","compareParams","createCallBackList","callbacks","add","cb","item","list","clear","createVueBaseHistory","handler","urlBase","baseEl","querySelector","getAttribute","normalizeBase","hrefHandler","baseHistory","historyAdapter","data","listenLocation","defineProperties","get","START_LOCATION","meta","ErrorTypes","RouterContext","createContext","RouteContext","CurrentRouteRecord","ViewDepth","depth","TokenType","scoreCompare","score1","score2","score1Length","score2Length","min","escapeStr","str","validChar","MatchScore","defaultOption","caseSensitive","strictMode","exact","REGEX_CHARS_RE","BASE_PARAM_PATTERN","DefaultDelimiter","createPathParser","option","_option$caseSensitive","_option$strictMode","_option$exact","pattern","scores","tokens","urlPath","cleanPath","Error","getLiteral","name","test","skipChar","curChar","prevChar","Static","Pattern","RBracket","LBracket","WildCard","Param","Delimiter","lexer","onlyHasWildCard","tokenCount","lastToken","asteriskCount","lookToNextDelimiter","currentIdx","hasOptionalParam","tokenIdx","token","nextToken","static","paramRegexp","param","wildcard","placeholder","regexp","RegExp","score","compile","wildCard","parse","reMatch","match","matchedPath","parseScore","_params$","splice","concat","fill","isExact","defaultMatcherOption","strict","sensitive","getLocationParams","newParams","agnosticRouteMatcher","routes","branchHandler","branches","branchesMap","Map","addBranch","route","parent","recursive","normalizedRecord","concatSlash","endsWith","branch","record","parser","raw","component","children","convertRecordToBranch","defaultOptions","partialOptions","mergedOption","mergeDefault","originalBranch","set","_step2","_iterator2","sort","delBranch","branchRef","delete","branchIndex","idx","matchPath","_step3","_iterator3","find","parentBranch","reverse","reduce","prev","currentValue","getNamedBranch","has","NavigationFailureSymbol","createRouterError","obj","useLink","router","useContext","currentRoute","useMemo","resolve","activeBranchIndex","targetMatched","currentMatched","findIndex","m","parentRecordPath","outer","inner","_ret","_loop2","innerValue","outerValue","some","includesParams","isExactActive","navigate","metaKey","altKey","ctrlKey","shiftKey","defaultPrevented","button","currentTarget","preventDefault","guardEvent","Promise","getLinkClass","propClass","globalClass","defaultClass","curr","RouterLink","link","activeClass","exactActiveClass","_router$option","linkActiveClass","linkExactActiveClass","classes","className","_jsx","onClick","RouterView","nextDepth","currentDepth","matchedRecord","calcNextDepth","routeRecord","nextComponent","jsx","Provider","initRouter","matcher","beforeEnter","leaveGuards","Set","redirected","redirect","updateGuards","beforeEachGuards","beforeResolveGuards","afterEachGuards","exceptListeners","observers","async","redirectFrom","failure","force","redirectLocation","lastMatched","newTarget","locationToObject","extractRedirect","redirectedFrom","NAVIGATION_DUPLICATED","triggerGuards","catch","triggerError","then","reject","doNavigate","triggerAfterEach","guards","_analyseChangingRecor","leavingRecords","updateRecords","enterRecords","maxLen","max","recordFrom","recordTo","analyseChangingRecord","guard","guardToPromise","runGuardQueue","beforeEachGuard","_step4","_iterator4","beforeEnters","map","_step5","_iterator5","triggerHistory","newAttrs","prevLocation","notifyUpdate","error","_step6","_iterator6","listening","normalizedLocation","matcherLocation","targetParams","_Object$keys","matchedRoute","stringifyUrl","normalizedQuery","normalizeQuery","beforeEach","beforeResolve","afterEach","onError","addRoute","removeRoute","hasRoute","Boolean","getRoutes","isReady","install","app","routerInstance","rootComponent","RouterProvider","config","globalProperties","$router","subscribeRouteChange","observer","promise","next","valid","NAVIGATION_ABORTED","NAVIGATION_GUARD_REDIRECT","guardReturn","guardCall","useRef","isMount","detachObserver","urlLocation","_useState","useState","setLocation","useLayoutEffect","onBeforeRouteLeave","leaveGuard","useRegisterGuards","onBeforeRouteUpdate","updateGuard","host","slicePos","hashIndex","protocol","immediate","unListener","useEffect"],"mappings":"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"}