{"version":3,"file":"pinia-adapter.js","sources":["../../../../../node_modules/.pnpm/@babel+runtime@7.23.8/node_modules/@babel/runtime/helpers/esm/extends.js","../../../src/pinia/pinia.ts"],"sourcesContent":["export default function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}","/*\n * Copyright (c) 2024 Huawei Technologies Co.,Ltd.\n *\n * openInula is licensed under Mulan PSL v2.\n * You can use this software according to the terms and conditions of the Mulan PSL v2.\n * You may obtain a copy of Mulan PSL v2 at:\n *\n *          http://license.coscl.org.cn/MulanPSL2\n *\n * THIS SOFTWARE IS PROVIDED ON AN \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND,\n * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,\n * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.\n * See the Mulan PSL v2 for more details.\n */\nimport { createStore, StoreObj, vueReactive } from '@cloudsop/horizon';\nimport {\n  FilterAction,\n  FilterComputed,\n  FilterState,\n  StoreDefinition,\n  StoreSetup,\n  Store,\n  AnyFunction,\n  ActionType,\n  StoreToRefsReturn,\n} from './types';\n\nconst { ref, isRef, toRef, isReactive, isReadonly } = vueReactive;\n\nconst storeMap = new Map<string, any>();\n\nexport function defineStore<\n  Id extends string,\n  S extends Record<string, unknown>,\n  A extends Record<string, AnyFunction>,\n  C extends Record<string, AnyFunction>,\n>(definition: StoreDefinition<Id, S, A, C>): (pinia?: any) => Store<S, A, C>;\n\nexport function defineStore<\n  Id extends string,\n  S extends Record<string, unknown>,\n  A extends Record<string, AnyFunction>,\n  C extends Record<string, AnyFunction>,\n>(id: Id, definition: Omit<StoreDefinition<Id, S, A, C>, 'id'>): (pinia?: any) => Store<S, A, C>;\n\nexport function defineStore<Id extends string, SS extends Record<any, unknown>>(\n  id: Id,\n  setup: StoreSetup<SS>\n): (pinia?: any) => Store<FilterState<SS>, FilterAction<SS>, FilterComputed<SS>>;\n\nexport function defineStore(idOrDef: any, setupOrDef?: any) {\n  let id: string;\n  let definition: StoreDefinition | StoreSetup;\n  let isSetup = false;\n\n  if (typeof idOrDef === 'string') {\n    isSetup = typeof setupOrDef === 'function';\n    id = idOrDef;\n    definition = setupOrDef;\n  } else {\n    id = idOrDef.id;\n    definition = idOrDef;\n  }\n\n  if (isSetup) {\n    return defineSetupStore(id, definition as StoreSetup);\n  } else {\n    return defineOptionsStore(id, definition as StoreDefinition);\n  }\n}\n\n/**\n * createStore实现中会给actions增加第一个参数store，pinia不需要，所以需要去掉\n * @param actions\n */\nfunction enhanceActions(\n  actions?: ActionType<Record<string, AnyFunction>, Record<string, unknown>, Record<string, AnyFunction>>\n) {\n  if (!actions) {\n    return {};\n  }\n\n  return Object.fromEntries(\n    Object.entries(actions).map(([key, value]) => {\n      return [\n        key,\n        function (this: StoreObj, state: Record<string, unknown>, ...args: any[]) {\n          return value.bind(this)(...args);\n        },\n      ];\n    })\n  );\n}\n\nfunction defineOptionsStore(id: string, definition: StoreDefinition) {\n  const state = definition.state ? definition.state() : {};\n  const computed = definition.getters || {};\n  const actions = enhanceActions(definition.actions) || {};\n\n  return () => {\n    if (storeMap.has(id)) {\n      return storeMap.get(id)!();\n    }\n\n    const useStore = createStore({\n      id,\n      state,\n      actions,\n      computed,\n    });\n\n    storeMap.set(id, useStore);\n\n    return useStore();\n  };\n}\n\nfunction defineSetupStore<SS extends Record<string, unknown>>(id: string, storeSetup: StoreSetup<SS>) {\n  return () => {\n    const data = storeSetup();\n    if (!data) {\n      return {};\n    }\n\n    if (storeMap.has(id)) {\n      return storeMap.get(id)!();\n    }\n\n    const state: Record<string, unknown> = {};\n    const actions: Record<string, AnyFunction> = {};\n    const getters: Record<string, AnyFunction> = {};\n    for (const key in data) {\n      const prop = data[key];\n\n      if ((isRef(prop) && !isReadonly(prop)) || isReactive(prop)) {\n        // state\n        state[key] = prop;\n      } else if (typeof prop === 'function') {\n        // action\n        actions[key] = prop as AnyFunction;\n      } else if (isRef(prop) && isReadonly(prop)) {\n        // getters\n        getters[key] = (prop as any).getter as AnyFunction;\n      }\n    }\n\n    const useStore = createStore({\n      id,\n      state,\n      computed: getters,\n      actions: enhanceActions(actions),\n    });\n\n    storeMap.set(id, useStore);\n\n    return useStore();\n  };\n}\n\nexport function mapStores<\n  S extends Record<string, unknown>,\n  A extends Record<string, AnyFunction>,\n  C extends Record<string, AnyFunction>,\n>(...stores: (() => Store<S, A, C>)[]): { [key: string]: () => Store<S, A, C> } {\n  const result: { [key: string]: () => Store<S, A, C> } = {};\n\n  stores.forEach((store: () => Store<S, A, C>) => {\n    const expandedStore = store();\n    result[`${expandedStore.id}Store`] = () => expandedStore;\n  });\n\n  return result;\n}\n\nexport function storeToRefs<\n  S extends Record<string, unknown>,\n  A extends Record<string, AnyFunction>,\n  C extends Record<string, AnyFunction>,\n>(store: Store<S, A, C>): StoreToRefsReturn<S, C> {\n  const stateRefs = Object.fromEntries(\n    Object.entries(store.$s || {}).map(([key, value]) => {\n      return [key, ref(value)];\n    })\n  );\n\n  const getterRefs = Object.fromEntries(\n    Object.entries(store.$config.computed || {}).map(([key, value]) => {\n      const computeFn = (value as () => any).bind(store, store.$s);\n      return [key, toRef(computeFn)];\n    })\n  );\n\n  return { ...stateRefs, ...getterRefs } as StoreToRefsReturn<S, C>;\n}\n\nexport function createPinia() {\n  console.warn(\n    `The pinia-adapter in Horizon does not support the createPinia interface. Please modify your code accordingly.`\n  );\n\n  const result = {\n    install: (app: any) => {},\n    use: (plugin: any) => result,\n    state: {},\n  };\n\n  return result;\n}\n"],"names":["_extends","Object","assign","bind","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","ref","vueReactive","isRef","toRef","isReactive","isReadonly","storeMap","Map","defineStore","idOrDef","setupOrDef","id","definition","isSetup","defineSetupStore","defineOptionsStore","enhanceActions","actions","fromEntries","entries","map","_ref","value","state","_len","args","Array","_key","computed","getters","has","get","useStore","createStore","set","storeSetup","data","prop","getter","mapStores","result","_len2","stores","_key2","forEach","store","expandedStore","storeToRefs","stateRefs","$s","_ref2","getterRefs","$config","_ref3","computeFn","createPinia","console","warn","install","app","use","plugin"],"mappings":";;;;;;AAAe,SAASA,QAAQA,GAAG;AACjCA,EAAAA,QAAQ,GAAGC,MAAM,CAACC,MAAM,GAAGD,MAAM,CAACC,MAAM,CAACC,IAAI,EAAE,GAAG,UAAUC,MAAM,EAAE;AAClE,IAAA,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGC,SAAS,CAACC,MAAM,EAAEF,CAAC,EAAE,EAAE;AACzC,MAAA,IAAIG,MAAM,GAAGF,SAAS,CAACD,CAAC,CAAC,CAAA;AACzB,MAAA,KAAK,IAAII,GAAG,IAAID,MAAM,EAAE;AACtB,QAAA,IAAIP,MAAM,CAACS,SAAS,CAACC,cAAc,CAACC,IAAI,CAACJ,MAAM,EAAEC,GAAG,CAAC,EAAE;AACrDL,UAAAA,MAAM,CAACK,GAAG,CAAC,GAAGD,MAAM,CAACC,GAAG,CAAC,CAAA;AAC3B,SAAA;AACF,OAAA;AACF,KAAA;AACA,IAAA,OAAOL,MAAM,CAAA;GACd,CAAA;AACD,EAAA,OAAOJ,QAAQ,CAACa,KAAK,CAAC,IAAI,EAAEP,SAAS,CAAC,CAAA;AACxC;;ACcA,IAAQQ,GAAG,GAA2CC,mBAAW,CAAzDD,GAAG;EAAEE,KAAK,GAAoCD,mBAAW,CAApDC,KAAK;EAAEC,KAAK,GAA6BF,mBAAW,CAA7CE,KAAK;EAAEC,UAAU,GAAiBH,mBAAW,CAAtCG,UAAU;EAAEC,UAAU,GAAKJ,mBAAW,CAA1BI,UAAU,CAAA;AAEjD,IAAMC,QAAQ,GAAG,IAAIC,GAAG,EAAe,CAAA;AAqBhC,SAASC,WAAWA,CAACC,OAAY,EAAEC,UAAgB,EAAE;AAC1D,EAAA,IAAIC,EAAU,CAAA;AACd,EAAA,IAAIC,UAAwC,CAAA;EAC5C,IAAIC,OAAO,GAAG,KAAK,CAAA;AAEnB,EAAA,IAAI,OAAOJ,OAAO,KAAK,QAAQ,EAAE;AAC/BI,IAAAA,OAAO,GAAG,OAAOH,UAAU,KAAK,UAAU,CAAA;AAC1CC,IAAAA,EAAE,GAAGF,OAAO,CAAA;AACZG,IAAAA,UAAU,GAAGF,UAAU,CAAA;AACzB,GAAC,MAAM;IACLC,EAAE,GAAGF,OAAO,CAACE,EAAE,CAAA;AACfC,IAAAA,UAAU,GAAGH,OAAO,CAAA;AACtB,GAAA;AAEA,EAAA,IAAII,OAAO,EAAE;AACX,IAAA,OAAOC,gBAAgB,CAACH,EAAE,EAAEC,UAAwB,CAAC,CAAA;AACvD,GAAC,MAAM;AACL,IAAA,OAAOG,kBAAkB,CAACJ,EAAE,EAAEC,UAA6B,CAAC,CAAA;AAC9D,GAAA;AACF,CAAA;;AAEA;AACA;AACA;AACA;AACA,SAASI,cAAcA,CACrBC,OAAuG,EACvG;EACA,IAAI,CAACA,OAAO,EAAE;AACZ,IAAA,OAAO,EAAE,CAAA;AACX,GAAA;AAEA,EAAA,OAAO9B,MAAM,CAAC+B,WAAW,CACvB/B,MAAM,CAACgC,OAAO,CAACF,OAAO,CAAC,CAACG,GAAG,CAAC,UAAAC,IAAA,EAAkB;IAAA,IAAhB1B,GAAG,GAAA0B,IAAA,CAAA,CAAA,CAAA;AAAEC,MAAAA,KAAK,GAAAD,IAAA,CAAA,CAAA,CAAA,CAAA;AACtC,IAAA,OAAO,CACL1B,GAAG,EACH,UAA0B4B,KAA8B,EAAkB;MAAA,KAAAC,IAAAA,IAAA,GAAAhC,SAAA,CAAAC,MAAA,EAAbgC,IAAI,OAAAC,KAAA,CAAAF,IAAA,GAAAA,CAAAA,GAAAA,IAAA,WAAAG,IAAA,GAAA,CAAA,EAAAA,IAAA,GAAAH,IAAA,EAAAG,IAAA,EAAA,EAAA;AAAJF,QAAAA,IAAI,CAAAE,IAAA,GAAAnC,CAAAA,CAAAA,GAAAA,SAAA,CAAAmC,IAAA,CAAA,CAAA;AAAA,OAAA;MAC/D,OAAOL,KAAK,CAACjC,IAAI,CAAC,IAAI,CAAC,CAAAU,KAAA,CAAI0B,KAAAA,CAAAA,EAAAA,IAAI,CAAC,CAAA;AAClC,KAAC,CACF,CAAA;AACH,GAAC,CACH,CAAC,CAAA;AACH,CAAA;AAEA,SAASV,kBAAkBA,CAACJ,EAAU,EAAEC,UAA2B,EAAE;AACnE,EAAA,IAAMW,KAAK,GAAGX,UAAU,CAACW,KAAK,GAAGX,UAAU,CAACW,KAAK,EAAE,GAAG,EAAE,CAAA;AACxD,EAAA,IAAMK,QAAQ,GAAGhB,UAAU,CAACiB,OAAO,IAAI,EAAE,CAAA;EACzC,IAAMZ,OAAO,GAAGD,cAAc,CAACJ,UAAU,CAACK,OAAO,CAAC,IAAI,EAAE,CAAA;AAExD,EAAA,OAAO,YAAM;AACX,IAAA,IAAIX,QAAQ,CAACwB,GAAG,CAACnB,EAAE,CAAC,EAAE;AACpB,MAAA,OAAOL,QAAQ,CAACyB,GAAG,CAACpB,EAAE,CAAC,EAAG,CAAA;AAC5B,KAAA;IAEA,IAAMqB,QAAQ,GAAGC,mBAAW,CAAC;AAC3BtB,MAAAA,EAAE,EAAFA,EAAE;AACFY,MAAAA,KAAK,EAALA,KAAK;AACLN,MAAAA,OAAO,EAAPA,OAAO;AACPW,MAAAA,QAAQ,EAARA,QAAAA;AACF,KAAC,CAAC,CAAA;AAEFtB,IAAAA,QAAQ,CAAC4B,GAAG,CAACvB,EAAE,EAAEqB,QAAQ,CAAC,CAAA;IAE1B,OAAOA,QAAQ,EAAE,CAAA;GAClB,CAAA;AACH,CAAA;AAEA,SAASlB,gBAAgBA,CAAqCH,EAAU,EAAEwB,UAA0B,EAAE;AACpG,EAAA,OAAO,YAAM;AACX,IAAA,IAAMC,IAAI,GAAGD,UAAU,EAAE,CAAA;IACzB,IAAI,CAACC,IAAI,EAAE;AACT,MAAA,OAAO,EAAE,CAAA;AACX,KAAA;AAEA,IAAA,IAAI9B,QAAQ,CAACwB,GAAG,CAACnB,EAAE,CAAC,EAAE;AACpB,MAAA,OAAOL,QAAQ,CAACyB,GAAG,CAACpB,EAAE,CAAC,EAAG,CAAA;AAC5B,KAAA;IAEA,IAAMY,KAA8B,GAAG,EAAE,CAAA;IACzC,IAAMN,OAAoC,GAAG,EAAE,CAAA;IAC/C,IAAMY,OAAoC,GAAG,EAAE,CAAA;AAC/C,IAAA,KAAK,IAAMlC,GAAG,IAAIyC,IAAI,EAAE;AACtB,MAAA,IAAMC,IAAI,GAAGD,IAAI,CAACzC,GAAG,CAAC,CAAA;AAEtB,MAAA,IAAKO,KAAK,CAACmC,IAAI,CAAC,IAAI,CAAChC,UAAU,CAACgC,IAAI,CAAC,IAAKjC,UAAU,CAACiC,IAAI,CAAC,EAAE;AAC1D;AACAd,QAAAA,KAAK,CAAC5B,GAAG,CAAC,GAAG0C,IAAI,CAAA;AACnB,OAAC,MAAM,IAAI,OAAOA,IAAI,KAAK,UAAU,EAAE;AACrC;AACApB,QAAAA,OAAO,CAACtB,GAAG,CAAC,GAAG0C,IAAmB,CAAA;OACnC,MAAM,IAAInC,KAAK,CAACmC,IAAI,CAAC,IAAIhC,UAAU,CAACgC,IAAI,CAAC,EAAE;AAC1C;AACAR,QAAAA,OAAO,CAAClC,GAAG,CAAC,GAAI0C,IAAI,CAASC,MAAqB,CAAA;AACpD,OAAA;AACF,KAAA;IAEA,IAAMN,QAAQ,GAAGC,mBAAW,CAAC;AAC3BtB,MAAAA,EAAE,EAAFA,EAAE;AACFY,MAAAA,KAAK,EAALA,KAAK;AACLK,MAAAA,QAAQ,EAAEC,OAAO;MACjBZ,OAAO,EAAED,cAAc,CAACC,OAAO,CAAA;AACjC,KAAC,CAAC,CAAA;AAEFX,IAAAA,QAAQ,CAAC4B,GAAG,CAACvB,EAAE,EAAEqB,QAAQ,CAAC,CAAA;IAE1B,OAAOA,QAAQ,EAAE,CAAA;GAClB,CAAA;AACH,CAAA;AAEO,SAASO,SAASA,GAIuD;EAC9E,IAAMC,MAA+C,GAAG,EAAE,CAAA;AAAC,EAAA,KAAA,IAAAC,KAAA,GAAAjD,SAAA,CAAAC,MAAA,EADxDiD,MAAM,GAAAhB,IAAAA,KAAA,CAAAe,KAAA,GAAAE,KAAA,GAAA,CAAA,EAAAA,KAAA,GAAAF,KAAA,EAAAE,KAAA,EAAA,EAAA;AAAND,IAAAA,MAAM,CAAAC,KAAA,CAAAnD,GAAAA,SAAA,CAAAmD,KAAA,CAAA,CAAA;AAAA,GAAA;AAGTD,EAAAA,MAAM,CAACE,OAAO,CAAC,UAACC,KAA2B,EAAK;AAC9C,IAAA,IAAMC,aAAa,GAAGD,KAAK,EAAE,CAAA;AAC7BL,IAAAA,MAAM,CAAIM,aAAa,CAACnC,EAAE,WAAQ,GAAG,YAAA;AAAA,MAAA,OAAMmC,aAAa,CAAA;AAAA,KAAA,CAAA;AAC1D,GAAC,CAAC,CAAA;AAEF,EAAA,OAAON,MAAM,CAAA;AACf,CAAA;AAEO,SAASO,WAAWA,CAIzBF,KAAqB,EAA2B;EAChD,IAAMG,SAAS,GAAG7D,MAAM,CAAC+B,WAAW,CAClC/B,MAAM,CAACgC,OAAO,CAAC0B,KAAK,CAACI,EAAE,IAAI,EAAE,CAAC,CAAC7B,GAAG,CAAC,UAAA8B,KAAA,EAAkB;IAAA,IAAhBvD,GAAG,GAAAuD,KAAA,CAAA,CAAA,CAAA;AAAE5B,MAAAA,KAAK,GAAA4B,KAAA,CAAA,CAAA,CAAA,CAAA;AAC7C,IAAA,OAAO,CAACvD,GAAG,EAAEK,GAAG,CAACsB,KAAK,CAAC,CAAC,CAAA;AAC1B,GAAC,CACH,CAAC,CAAA;EAED,IAAM6B,UAAU,GAAGhE,MAAM,CAAC+B,WAAW,CACnC/B,MAAM,CAACgC,OAAO,CAAC0B,KAAK,CAACO,OAAO,CAACxB,QAAQ,IAAI,EAAE,CAAC,CAACR,GAAG,CAAC,UAAAiC,KAAA,EAAkB;IAAA,IAAhB1D,GAAG,GAAA0D,KAAA,CAAA,CAAA,CAAA;AAAE/B,MAAAA,KAAK,GAAA+B,KAAA,CAAA,CAAA,CAAA,CAAA;IAC3D,IAAMC,SAAS,GAAIhC,KAAK,CAAejC,IAAI,CAACwD,KAAK,EAAEA,KAAK,CAACI,EAAE,CAAC,CAAA;AAC5D,IAAA,OAAO,CAACtD,GAAG,EAAEQ,KAAK,CAACmD,SAAS,CAAC,CAAC,CAAA;AAChC,GAAC,CACH,CAAC,CAAA;AAED,EAAA,OAAApE,QAAA,CAAA,EAAA,EAAY8D,SAAS,EAAKG,UAAU,CAAA,CAAA;AACtC,CAAA;AAEO,SAASI,WAAWA,GAAG;EAC5BC,OAAO,CAACC,IAAI,CAAA,+GAEZ,CAAC,CAAA;AAED,EAAA,IAAMjB,MAAM,GAAG;AACbkB,IAAAA,OAAO,EAAE,UAACC,GAAQ,EAAK,EAAE;IACzBC,GAAG,EAAE,UAACC,MAAW,EAAA;AAAA,MAAA,OAAKrB,MAAM,CAAA;AAAA,KAAA;AAC5BjB,IAAAA,KAAK,EAAE,EAAC;GACT,CAAA;AAED,EAAA,OAAOiB,MAAM,CAAA;AACf;;;;;;;"}