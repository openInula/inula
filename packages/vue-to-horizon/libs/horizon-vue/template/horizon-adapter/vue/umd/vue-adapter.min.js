!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@cloudsop/horizon"),require("@cloudsop/horizon/jsx-runtime")):"function"==typeof define&&define.amd?define(["exports","@cloudsop/horizon","@cloudsop/horizon/jsx-runtime"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).VueAdapter={},e.Horizon,e.jsxRuntime)}(this,(function(e,n,t){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=r(n),i=function(){var e=n.useRef(!1);return n.useEffect((function(){return e.current=!0,function(){e.current=!1}}),[]),e.current};function u(){return(u=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function c(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}var a=Symbol("_v_show_original_display"),f={beforeMount:function(e,n){var t=n.value;e[a]="none"===e.style.display?"":e.style.display,s(e,t)},updated:function(e,n){var t=n.value;!t!=!n.oldValue&&s(e,t)},beforeUnmount:function(e,n){s(e,n.value)}};function s(e,n){e.style.display=n?e[a]:"none"}var l=["componentName"],p=n.vueReactive.useInstance;function v(){return{app:null,config:{globalProperties:{}},components:{},directives:{},provides:Object.create(null)}}function d(e){var n=e.appContext;return t.jsx(n.Provider,{value:e.value,children:e.root})}var m=new Map,y=n.createContext(null);function h(e){return e.split("-").map((function(e){return e.charAt(0).toUpperCase()+e.substr(1)})).join("")}function g(){return n.useContext(y)._context.directives}function A(e,n){var t=e[n];if("function"!=typeof t&&"string"==typeof n&&!n.startsWith("on")){var r=n.charAt(0).toUpperCase()+n.slice(1),o="on"+r;t=e[o]}if("function"==typeof t){for(var i=arguments.length,u=new Array(i>2?i-2:0),c=2;c<i;c++)u[c-2]=arguments[c];t.apply(void 0,u)}else console.warn("Attempted to emit event '"+String(n)+"' but no handler was defined.")}function b(){var e=p(),t=n.useContext(y);return{vnode:{get el(){return e.$el}},proxy:e,appContext:{app:t}}}var E=["children","componentName","directives","registerDirectives"],x=n.vueReactive.useInstance;var j=function(e){var n=e.children;return e.condition?t.jsx(t.Fragment,{children:n}):null},C=j,w=function(e){var n=e.children;return t.jsx(t.Fragment,{children:n})},T=["is","components"];var P=n.vueReactive.useInstance;function N(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce((function(e,n){return u({},e,O(n))}),{})}var I=function(e){return e.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}))},O=function(e){return"string"==typeof e?(n={},e.split(";").forEach((function(e){var t=e.split(":").map((function(e){return e.trim()})),r=t[0],o=t[1];r&&o&&(n[I(r)]=o)})),n):Array.isArray(e)?e.reduce((function(e,n){return u({},e,O(n))}),{}):"object"==typeof e&&null!==e?function(e){var n={};for(var t in e){var r=I(t),o=e[t];"number"!=typeof o||isNaN(o)||["zIndex","opacity","fontWeight"].includes(r)||(o+="px"),n[r]=o}return n}(e):{};var n},R=n.vueReactive.useInstance;function S(e){for(var n=e;n.child;){if(n.child.next)return!0;if("DomComponent"===n.child.tag)break;n=n.child}return!1}function _(){var e=R(),t=n.useRef(e.$props.className);n.useEffect((function(){if(!S(e.$vnode)){var n=e.$el,r=e.$props.className||"";n.className||(n.className=""),t.current&&n.className.includes(t.current)?n.className=n.className.replace(t.current,r).trim():r&&(n.className=n.className?(n.className+" "+r).trim():r),t.current=r}}),[e.$props.className]),n.useEffect((function(){if(!S(e.$vnode)){var n=e.$el;if(e.$props.style){var t=N(n.style.cssText,e.$props.style);Object.entries(t).forEach((function(e){var t=e[0],r=e[1];t&&(n.style[t.trim()]="string"==typeof r?r.trim():r)}))}}}),[e.$props.style]),n.useEffect((function(){if(!S(e.$vnode)){var n=e.$el,t=Object.keys(e.$props).find((function(e){return e.startsWith("data-v-")&&15===e.length}));t&&n.setAttribute(t,e.$props[t])}}),[])}var k=n.vueReactive.shallowReactive;function U(e,n){var t={};return function(e,n,t){if(e)for(var r in e){var o=e[r];n[r]=M(t,r,o)}for(var i in t)!Object.prototype.hasOwnProperty.call(t,i)||Object.prototype.hasOwnProperty.call(n,i)&&void 0!==n[i]||(n[i]=M(t,i,n[i]))}(e,t,n),k(t)}function D(e,n,t){for(var r in n){var o=n[r];e[r]=M(t,r,o)}}function M(e,n,t){var r=e[n];if(null!=r&&null!=r.default&&void 0===t){var o=r.default;t="function"!=typeof o||r.type&&r.type===Function?o:o()}return t}var $=["value","onChange"],L=new Map;function V(e,t){L.has(e)?L.get(e).value=t:L.set(e,n.createContext(t))}function z(e,n){if(L.has(e))return L.get(e).value;if(!n)throw Error("Injected value is not provided. Make sure to provide it before use or add default value");return n}function F(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return W(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?W(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==t.return||t.return()}finally{if(c)throw i}}}}function W(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e){var n=function(e,n){if("object"!=H(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=H(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==H(n)?n:String(n)}function B(e,n,t){return(n=K(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var q=n.createContext(null),G=function(e){return e.ACTIVATE="componentDidActivate",e.UNACTIVATE="componentWillUnactivate",e}({}),Y=function(e,t){var r=n.useContext(q);if(r){var o=n.useRef(t);n.useEffect((function(){var n=r[e].indexOf(o.current);n>=0?r[e].splice(n,1,t):r[e].push(t),o.current=t}),[t])}},X=Y.bind(null,G.ACTIVATE),J=Y.bind(null,G.UNACTIVATE),Q=function(e){var r,o=e.children,i=e.active,u=n.useRef(null),c=n.useRef([]),a=n.useRef((B(r={},G.ACTIVATE,[]),B(r,G.UNACTIVATE,[]),r));return n.useEffect((function(){return function(){c.current.forEach((function(e){e.remove()})),a.current[G.UNACTIVATE].forEach((function(e){e()}))}}),[]),n.useEffect((function(){var e;i?(c.current=Array.from((null===(e=u.current)||void 0===e?void 0:e.children)||[]),c.current.forEach((function(e){var n,t;null===(n=u.current)||void 0===n||null===(t=n.parentElement)||void 0===t||t.insertBefore(e,u.current)})),a.current[G.ACTIVATE].forEach((function(e){e()}))):(c.current.forEach((function(e){var n;null===(n=u.current)||void 0===n||n.appendChild(e)})),a.current[G.UNACTIVATE].forEach((function(e){e()})))}),[i]),t.jsx(q.Provider,{value:a.current,children:t.jsx("div",{style:{display:"none"},ref:u,children:o})})};function Z(e,n){return Array.isArray(n)?n.find((function(n){return Z(e,n)})):"string"==typeof n?n.split(",").includes(e):"[object RegExp]"===Object.prototype.toString.call(n)&&n.test(e)}function ee(e){var n,t=e.props,r=t.ref,o=t.is;return r||(o?"function"==typeof o?o.name||o.displayName:o:null==e||null===(n=e.type)||void 0===n?void 0:n.name)}e.ConditionalRenderer=function(e){var r=e.children,o=n.Children.toArray(r).find((function(e){if(n.isValidElement(e)){if(e.type===j||e.type===C)return e.props.condition;if(e.type===w)return!0}return!1}));return o?t.jsx(t.Fragment,{children:o}):null},e.DirectiveComponent=function(e){var t=e.children,r=e.componentName,o=e.directives,i=e.registerDirectives,a=c(e,E),f=g(),s=x();n.useLayoutEffect((function(){return p("beforeMount",o),p("mounted",o),p("bind",o),function(){p("beforeUnmount",o),p("unmounted",o),p("unbind",o)}}),[]),n.useEffect((function(){p("updated",o),p("update",o),p("componentUpdated",o)}));var l=n.useMemo((function(){return{}}),[]),p=n.useCallback((function(e,n){n.forEach((function(n){var t=n.name,r=n.value,o=n.arg,u=n.modifiers,c=l[t];l[t]=r;var a={};(a=i&&i[t]?i[t]:f[t])&&a[e]&&a[e](s.$el,{value:r,oldValue:c,arg:o,modifiers:u})}))}),[]);return n.createElement(r,u({},a),t)},e.DynamicComponent=function(e){var n=e.is,r=e.components,o=c(e,T);if(""===n)return null;var i=null;if("string"==typeof n){var a=function(e){if(!e.includes("-"))return e.charAt(0).toUpperCase()+e.slice(1);return e.split("-").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join("")}(n);if(!(i=r&&r[a]))i=b().appContext.app._context.components[a]}else"function"==typeof n&&(i=n);return i||(i=n),t.jsx(i,u({},o))},e.Else=w,e.ElseIf=C,e.GlobalComponent=function(e){var r=e.componentName,o=c(e,l),i=n.useContext(y);r=h(r);var a=i._context.components[r];if(!a)throw new Error("Component "+r+" not found, please register it first.");return t.jsx(a,u({},o))},e.If=j,e.KeepAlive=function(e){var r=e.children,o=e.exclude,i=e.include,u=e.max,c=void 0===u?Number.MAX_SAFE_INTEGER:u,a=n.useRef(new Map),f=n.useRef([]),s=n.useState(null),l=s[0],p=s[1],v=n.useMemo((function(){var e=ee(r),n=!i||Z(e,i),t=!o||!Z(e,o);return n&&t&&0!==c}),[r,i,o,c]);return n.useEffect((function(){if(r){var e=ee(r);if(v){if(e===l)return;a.current.set(e,{key:e,children:r});var n=function(e,n,t){var r=e.indexOf(n),o="";return r>=0?e.splice(r,1):e.length>=t&&(o=e.shift()),e.push(n),o}(f.current,e,c);n&&a.current.delete(n)}else a.current.delete(e);p(e)}else p(null)}),[r]),t.jsxs(t.Fragment,{children:[Array.from(a.current.values()).map((function(e){var n=e.children,r=e.key;return t.jsx(Q,{children:n,active:r===l},r)})),v?null:r]})},e.KeepAlivePro=function(e){var r,o,i=e.children,u=e.max,c=void 0===u?1/0:u,a=e.include,f=e.exclude,s=n.useRef(new Map),l=Array.isArray(i)?i[0]:i,p=l.props.ref||(null===(r=l.props.is)||void 0===r?void 0:r.name),v=n.useRef(new Map),d=n.useRef(new Map);V("onActivatedListeners",v.current),V("onDeactivatedListeners",d.current),n.useEffect((function(){return function(){Array.from(s.current.entries()).forEach((function(e){var n=e[0];if(e[1],V("keep-alive-key",n),p===n){var t=z("onDeactivatedListeners").get(n);if(!t)return;Array.from(t).forEach((function(e){e()}))}}))}}));var m=function(e,n,t){if(t){Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;r++)if("string"==typeof t[r]){for(var o=t[r].split(/,\s*/g),i=0;i<o.length;i++)if(e===o[i])return!1}else if(t[r]instanceof RegExp&&t[r].exec(e))return!1}if(n){Array.isArray(n)||(n=[n]);for(var u=0;u<n.length;u++)if("string"==typeof n[u]){for(var c=n[u].split(/,\s*/g),a=0;a<c.length;a++)if(e===c[a])return!0}else if(n[u]instanceof RegExp&&n[u].exec(e))return!0;return!1}return!0}(p,a,f);if(m)if(s.current.has(p))(o=s.current.get(p)).component,o.timestamp=Date.now();else{if(s.current.size>=c){var y,h="",g=1/0,A=F(s.current);try{for(A.s();!(y=A.n()).done;){var b=y.value,E=b[0],x=b[1];x.timestamp<g&&(g=x.timestamp,h=E)}}catch(e){A.e(e)}finally{A.f()}null!==h&&s.current.delete(h)}s.current.set(p,{timestamp:Date.now(),component:l}),s.current.get(p)}return t.jsxs(t.Fragment,{children:[Array.from(s.current.entries()).map((function(e){var n=e[0],r=e[1];return V("keep-alive-key",n),p===n&&setTimeout((function(){var e=z("onActivatedListeners").get(n);e&&Array.from(e).forEach((function(e){e()}))}),1),t.jsx("div",{style:p===n?{}:{display:"none"},children:r.component})})),m?[]:t.jsx("div",{children:l})]})},e.SemiControlledInput=function(e){var r=e.value,o=void 0===r?{value:""}:r,i=e.onChange,a=c(e,$),f=n.useState(o.value),s=f[0],l=f[1],p=n.useRef(null);n.useEffect((function(){o.value!==s&&l(o.value)}),[o]),n.useEffect((function(){var e=p.current;if(e){var n=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value");if(n){var t=n.set;return Object.defineProperty(e,"value",{get:n.get,set:function(n){var r;null==t||t.call(this,n),(r=e.value)!==s&&(l(r),i&&i({target:{value:r}}))},configurable:!0}),function(){Object.defineProperty(e,"value",n)}}}}),[i,s]);return t.jsx("input",u({ref:p,value:s,onChange:function(e){var n=e.target.value;l(n),i&&i(e)}},a))},e.createApp=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DEFAULT_APP_KEY",i=v(),u=new WeakSet,c=!1;"function"==typeof e&&(e=o.default.createElement(e,{}));var a=i.app={_container:null,_context:i,rootComponent:e,version:"1.0.0",get config(){return i.config},set config(e){},use:function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return u.has(e)||(e&&"function"==typeof e.install?(u.add(e),e.install.apply(e,[a].concat(t))):"function"==typeof e&&(u.add(e),e.apply(void 0,[a].concat(t)))),a},mixin:function(e){return console.log("Horizon中暂时不支持mixin，请用Hook方式进行改造代码。"),a},component:function(e,n){var t=h(e);return n?(i.components[t]=n,a):i.components[t]},directive:function(e,n){return n?(i.directives[e]=n,a):i.directives[e]},mount:function(e){c||("string"==typeof e&&(e=document.querySelector(e)),n.render(t.jsx(d,{root:a.rootComponent,appContext:y,value:a}),e),c=!0,a._container=e)},unmount:function(){c&&(n.unmountComponentAtNode(a._container),delete a._container)},provide:function(e,n){return i.provides[e]=n,a},runWithContext:function(e){return console.log("Horizon中暂时不支持runWithContext，请手动修改相关的代码。"),e()}};return a.directive("show",f),m.set(r,a),a},e.createAppContext=v,e.defineAsyncComponent=function(e){var r=n.lazy(e);return function(e){return t.jsx(n.Suspense,{fallback:null,children:t.jsx(r,u({},e))})}},e.defineEmits=function(e,n){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];A.apply(void 0,[n,e].concat(r))}},e.defineExpose=function(e){var n=P();n?"object"==typeof e&&null!==e?Object.keys(e).forEach((function(t){n[t]=e[t]})):console.warn("defineExpose: Argument should be an object"):console.warn("defineExpose: No instance found. Make sure this is called inside a component setup function.")},e.emit=A,e.getCurrentInstance=b,e.initProps=U,e.inject=z,e.onActivated=function(e){var n=z("onActivatedListeners"),t=z("keep-alive-key");return n.has(t)||n.set(t,new Set),n.get(t).add(e),function(){var n=z("onActivatedListeners"),t=z("keep-alive-key");n.get(t).delete(e)}},e.onBeforeMount=function(e){i()||null==e||e()},e.onBeforeUnmount=function(e){n.useLayoutEffect((function(){return function(){null==e||e()}}),[])},e.onBeforeUpdate=function(e){n.useEffect((function(){null==e||e()}))},e.onDeactivated=function(e){var n=z("onDeactivatedListeners"),t=z("keep-alive-key");return n.has(t)||n.set(t,new Set),n.get(t).add(e),function(){var n=z("onDeactivatedListeners"),t=z("keep-alive-key");n.get(t).delete(e)}},e.onMounted=function(e){n.useEffect((function(){null==e||e()}),[])},e.onUnmounted=function(e){n.useEffect((function(){return function(){null==e||e()}}),[])},e.onUpdated=function(e){n.useEffect((function(){null==e||e()}))},e.provide=V,e.registerComponent=function(e,n){m.get("DEFAULT_APP_KEY").component(e,n)},e.registerDirective=function(e,n){m.get("DEFAULT_APP_KEY").directive(e,n)},e.setToInstance=function(e,n){return n&&"object"==typeof n&&!Array.isArray(n)?(Object.entries(n).forEach((function(n){var t=n[0],r=n[1];t?e[t]=r:console.warn("跳过没有键名的项:",r)})),e):(Array.isArray(n)?n.forEach((function(n){if(Array.isArray(n)){var t=n[0],r=n[1];t?e[t]=r:console.warn("跳过没有键名的数组项:",n)}else if("function"!=typeof n)console.warn("跳过无效的项:",n);else{var o=n.name;o?e[o]=n:console.warn("跳过未命名的函数")}})):console.warn("无效的 items 类型:",n),e)},e.styles=N,e.updateProps=D,e.useActivatePro=X,e.useAttrs=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=u({},e);n.forEach((function(e){return delete t[e]}));var r=P();return r.$attrs=t,t},e.useDirectives=g,e.useGlobalProperties=function(e){var t=n.useContext(y);return e?t.config.globalProperties[e]:t.config.globalProperties},e.useIsMounted=i,e.useProvide=function(e){return n.useContext(y)._context.provides[e]},e.useReactiveProps=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.useRef(null);return null===r.current?r.current=U(e,t):D(r.current,e,t),_(),r.current},e.useSlots=function(e){var n={};return Object.entries(e).forEach((function(e){var t=e[0],r=e[1];if(t.startsWith("template_")){var o=t.replace("template_","");n[o]=r}})),e.children&&(n.default=e.children),n},e.useUnActivatePro=J,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vue-adapter.min.js.map
