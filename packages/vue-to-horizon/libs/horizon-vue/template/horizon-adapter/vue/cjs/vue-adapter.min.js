"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@cloudsop/horizon"),n=require("@cloudsop/horizon/jsx-runtime");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e),o=function(){var n=e.useRef(!1);return e.useEffect((function(){return n.current=!0,function(){n.current=!1}}),[]),n.current};function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function u(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}var c=Symbol("_v_show_original_display"),a={beforeMount:function(e,n){var t=n.value;e[c]="none"===e.style.display?"":e.style.display,s(e,t)},updated:function(e,n){var t=n.value;!t!=!n.oldValue&&s(e,t)},beforeUnmount:function(e,n){s(e,n.value)}};function s(e,n){e.style.display=n?e[c]:"none"}var f=["componentName"],l=e.vueReactive.useInstance;function p(){return{app:null,config:{globalProperties:{}},components:{},directives:{},provides:Object.create(null)}}function v(e){var t=e.appContext;return n.jsx(t.Provider,{value:e.value,children:e.root})}var d=new Map,m=e.createContext(null);function y(e){return e.split("-").map((function(e){return e.charAt(0).toUpperCase()+e.substr(1)})).join("")}function h(){return e.useContext(m)._context.directives}function x(e,n){var t=e[n];if("function"!=typeof t&&"string"==typeof n&&!n.startsWith("on")){var r=n.charAt(0).toUpperCase()+n.slice(1),o="on"+r;t=e[o]}if("function"==typeof t){for(var i=arguments.length,u=new Array(i>2?i-2:0),c=2;c<i;c++)u[c-2]=arguments[c];t.apply(void 0,u)}else console.warn("Attempted to emit event '"+String(n)+"' but no handler was defined.")}function g(){var n=l(),t=e.useContext(m);return{vnode:{get el(){return n.$el}},proxy:n,appContext:{app:t}}}var A=["children","componentName","directives","registerDirectives"],b=e.vueReactive.useInstance;var E=function(e){var t=e.children;return e.condition?n.jsx(n.Fragment,{children:t}):null},j=E,C=function(e){var t=e.children;return n.jsx(n.Fragment,{children:t})},w=["is","components"];var P=e.vueReactive.useInstance;function N(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce((function(e,n){return i({},e,I(n))}),{})}var T=function(e){return e.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}))},I=function(e){return"string"==typeof e?(n={},e.split(";").forEach((function(e){var t=e.split(":").map((function(e){return e.trim()})),r=t[0],o=t[1];r&&o&&(n[T(r)]=o)})),n):Array.isArray(e)?e.reduce((function(e,n){return i({},e,I(n))}),{}):"object"==typeof e&&null!==e?function(e){var n={};for(var t in e){var r=T(t),o=e[t];"number"!=typeof o||isNaN(o)||["zIndex","opacity","fontWeight"].includes(r)||(o+="px"),n[r]=o}return n}(e):{};var n},O=e.vueReactive.useInstance;function S(e){for(var n=e;n.child;){if(n.child.next)return!0;if("DomComponent"===n.child.tag)break;n=n.child}return!1}function R(){var n=O(),t=e.useRef(n.$props.className);e.useEffect((function(){if(!S(n.$vnode)){var e=n.$el,r=n.$props.className||"";e.className||(e.className=""),t.current&&e.className.includes(t.current)?e.className=e.className.replace(t.current,r).trim():r&&(e.className=e.className?(e.className+" "+r).trim():r),t.current=r}}),[n.$props.className]),e.useEffect((function(){if(!S(n.$vnode)){var e=n.$el;if(n.$props.style){var t=N(e.style.cssText,n.$props.style);Object.entries(t).forEach((function(n){var t=n[0],r=n[1];t&&(e.style[t.trim()]="string"==typeof r?r.trim():r)}))}}}),[n.$props.style]),e.useEffect((function(){if(!S(n.$vnode)){var e=n.$el,t=Object.keys(n.$props).find((function(e){return e.startsWith("data-v-")&&15===e.length}));t&&e.setAttribute(t,n.$props[t])}}),[])}var _=e.vueReactive.shallowReactive;function k(e,n){var t={};return function(e,n,t){if(e)for(var r in e){var o=e[r];n[r]=D(t,r,o)}for(var i in t)!Object.prototype.hasOwnProperty.call(t,i)||Object.prototype.hasOwnProperty.call(n,i)&&void 0!==n[i]||(n[i]=D(t,i,n[i]))}(e,t,n),_(t)}function U(e,n,t){for(var r in n){var o=n[r];e[r]=D(t,r,o)}}function D(e,n,t){var r=e[n];if(null!=r&&null!=r.default&&void 0===t){var o=r.default;t="function"!=typeof o||r.type&&r.type===Function?o:o()}return t}var M=["value","onChange"],$=new Map;function L(n,t){$.has(n)?$.get(n).value=t:$.set(n,e.createContext(t))}function V(e,n){if($.has(e))return $.get(e).value;if(!n)throw Error("Injected value is not provided. Make sure to provide it before use or add default value");return n}function F(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return z(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?z(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==t.return||t.return()}finally{if(c)throw i}}}}function z(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e){var n=function(e,n){if("object"!=W(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=W(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==W(n)?n:String(n)}function B(e,n,t){return(n=K(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var H=e.createContext(null),q=function(e){return e.ACTIVATE="componentDidActivate",e.UNACTIVATE="componentWillUnactivate",e}({}),G=function(n,t){var r=e.useContext(H);if(r){var o=e.useRef(t);e.useEffect((function(){var e=r[n].indexOf(o.current);e>=0?r[n].splice(e,1,t):r[n].push(t),o.current=t}),[t])}},Y=G.bind(null,q.ACTIVATE),X=G.bind(null,q.UNACTIVATE),J=function(t){var r,o=t.children,i=t.active,u=e.useRef(null),c=e.useRef([]),a=e.useRef((B(r={},q.ACTIVATE,[]),B(r,q.UNACTIVATE,[]),r));return e.useEffect((function(){return function(){c.current.forEach((function(e){e.remove()})),a.current[q.UNACTIVATE].forEach((function(e){e()}))}}),[]),e.useEffect((function(){var e;i?(c.current=Array.from((null===(e=u.current)||void 0===e?void 0:e.children)||[]),c.current.forEach((function(e){var n,t;null===(n=u.current)||void 0===n||null===(t=n.parentElement)||void 0===t||t.insertBefore(e,u.current)})),a.current[q.ACTIVATE].forEach((function(e){e()}))):(c.current.forEach((function(e){var n;null===(n=u.current)||void 0===n||n.appendChild(e)})),a.current[q.UNACTIVATE].forEach((function(e){e()})))}),[i]),n.jsx(H.Provider,{value:a.current,children:n.jsx("div",{style:{display:"none"},ref:u,children:o})})};function Q(e,n){return Array.isArray(n)?n.find((function(n){return Q(e,n)})):"string"==typeof n?n.split(",").includes(e):"[object RegExp]"===Object.prototype.toString.call(n)&&n.test(e)}function Z(e){var n,t=e.props,r=t.ref,o=t.is;return r||(o?"function"==typeof o?o.name||o.displayName:o:null==e||null===(n=e.type)||void 0===n?void 0:n.name)}exports.ConditionalRenderer=function(t){var r=t.children,o=e.Children.toArray(r).find((function(n){if(e.isValidElement(n)){if(n.type===E||n.type===j)return n.props.condition;if(n.type===C)return!0}return!1}));return o?n.jsx(n.Fragment,{children:o}):null},exports.DirectiveComponent=function(n){var t=n.children,r=n.componentName,o=n.directives,c=n.registerDirectives,a=u(n,A),s=h(),f=b();e.useLayoutEffect((function(){return p("beforeMount",o),p("mounted",o),p("bind",o),function(){p("beforeUnmount",o),p("unmounted",o),p("unbind",o)}}),[]),e.useEffect((function(){p("updated",o),p("update",o),p("componentUpdated",o)}));var l=e.useMemo((function(){return{}}),[]),p=e.useCallback((function(e,n){n.forEach((function(n){var t=n.name,r=n.value,o=n.arg,i=n.modifiers,u=l[t];l[t]=r;var a={};(a=c&&c[t]?c[t]:s[t])&&a[e]&&a[e](f.$el,{value:r,oldValue:u,arg:o,modifiers:i})}))}),[]);return e.createElement(r,i({},a),t)},exports.DynamicComponent=function(e){var t=e.is,r=e.components,o=u(e,w);if(""===t)return null;var c=null;if("string"==typeof t){var a=function(e){if(!e.includes("-"))return e.charAt(0).toUpperCase()+e.slice(1);return e.split("-").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join("")}(t);if(!(c=r&&r[a]))c=g().appContext.app._context.components[a]}else"function"==typeof t&&(c=t);return c||(c=t),n.jsx(c,i({},o))},exports.Else=C,exports.ElseIf=j,exports.GlobalComponent=function(t){var r=t.componentName,o=u(t,f),c=e.useContext(m);r=y(r);var a=c._context.components[r];if(!a)throw new Error("Component "+r+" not found, please register it first.");return n.jsx(a,i({},o))},exports.If=E,exports.KeepAlive=function(t){var r=t.children,o=t.exclude,i=t.include,u=t.max,c=void 0===u?Number.MAX_SAFE_INTEGER:u,a=e.useRef(new Map),s=e.useRef([]),f=e.useState(null),l=f[0],p=f[1],v=e.useMemo((function(){var e=Z(r),n=!i||Q(e,i),t=!o||!Q(e,o);return n&&t&&0!==c}),[r,i,o,c]);return e.useEffect((function(){if(r){var e=Z(r);if(v){if(e===l)return;a.current.set(e,{key:e,children:r});var n=function(e,n,t){var r=e.indexOf(n),o="";return r>=0?e.splice(r,1):e.length>=t&&(o=e.shift()),e.push(n),o}(s.current,e,c);n&&a.current.delete(n)}else a.current.delete(e);p(e)}else p(null)}),[r]),n.jsxs(n.Fragment,{children:[Array.from(a.current.values()).map((function(e){var t=e.children,r=e.key;return n.jsx(J,{children:t,active:r===l},r)})),v?null:r]})},exports.KeepAlivePro=function(t){var r,o,i=t.children,u=t.max,c=void 0===u?1/0:u,a=t.include,s=t.exclude,f=e.useRef(new Map),l=Array.isArray(i)?i[0]:i,p=l.props.ref||(null===(r=l.props.is)||void 0===r?void 0:r.name),v=e.useRef(new Map),d=e.useRef(new Map);L("onActivatedListeners",v.current),L("onDeactivatedListeners",d.current),e.useEffect((function(){return function(){Array.from(f.current.entries()).forEach((function(e){var n=e[0];if(e[1],L("keep-alive-key",n),p===n){var t=V("onDeactivatedListeners").get(n);if(!t)return;Array.from(t).forEach((function(e){e()}))}}))}}));var m=function(e,n,t){if(t){Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;r++)if("string"==typeof t[r]){for(var o=t[r].split(/,\s*/g),i=0;i<o.length;i++)if(e===o[i])return!1}else if(t[r]instanceof RegExp&&t[r].exec(e))return!1}if(n){Array.isArray(n)||(n=[n]);for(var u=0;u<n.length;u++)if("string"==typeof n[u]){for(var c=n[u].split(/,\s*/g),a=0;a<c.length;a++)if(e===c[a])return!0}else if(n[u]instanceof RegExp&&n[u].exec(e))return!0;return!1}return!0}(p,a,s);if(m)if(f.current.has(p))(o=f.current.get(p)).component,o.timestamp=Date.now();else{if(f.current.size>=c){var y,h="",x=1/0,g=F(f.current);try{for(g.s();!(y=g.n()).done;){var A=y.value,b=A[0],E=A[1];E.timestamp<x&&(x=E.timestamp,h=b)}}catch(e){g.e(e)}finally{g.f()}null!==h&&f.current.delete(h)}f.current.set(p,{timestamp:Date.now(),component:l}),f.current.get(p)}return n.jsxs(n.Fragment,{children:[Array.from(f.current.entries()).map((function(e){var t=e[0],r=e[1];return L("keep-alive-key",t),p===t&&setTimeout((function(){var e=V("onActivatedListeners").get(t);e&&Array.from(e).forEach((function(e){e()}))}),1),n.jsx("div",{style:p===t?{}:{display:"none"},children:r.component})})),m?[]:n.jsx("div",{children:l})]})},exports.SemiControlledInput=function(t){var r=t.value,o=void 0===r?{value:""}:r,c=t.onChange,a=u(t,M),s=e.useState(o.value),f=s[0],l=s[1],p=e.useRef(null);e.useEffect((function(){o.value!==f&&l(o.value)}),[o]),e.useEffect((function(){var e=p.current;if(e){var n=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value");if(n){var t=n.set;return Object.defineProperty(e,"value",{get:n.get,set:function(n){var r;null==t||t.call(this,n),(r=e.value)!==f&&(l(r),c&&c({target:{value:r}}))},configurable:!0}),function(){Object.defineProperty(e,"value",n)}}}}),[c,f]);return n.jsx("input",i({ref:p,value:f,onChange:function(e){var n=e.target.value;l(n),c&&c(e)}},a))},exports.createApp=function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DEFAULT_APP_KEY",i=p(),u=new WeakSet,c=!1;"function"==typeof t&&(t=r.default.createElement(t,{}));var s=i.app={_container:null,_context:i,rootComponent:t,version:"1.0.0",get config(){return i.config},set config(e){},use:function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return u.has(e)||(e&&"function"==typeof e.install?(u.add(e),e.install.apply(e,[s].concat(t))):"function"==typeof e&&(u.add(e),e.apply(void 0,[s].concat(t)))),s},mixin:function(e){return console.log("Horizon中暂时不支持mixin，请用Hook方式进行改造代码。"),s},component:function(e,n){var t=y(e);return n?(i.components[t]=n,s):i.components[t]},directive:function(e,n){return n?(i.directives[e]=n,s):i.directives[e]},mount:function(t){c||("string"==typeof t&&(t=document.querySelector(t)),e.render(n.jsx(v,{root:s.rootComponent,appContext:m,value:s}),t),c=!0,s._container=t)},unmount:function(){c&&(e.unmountComponentAtNode(s._container),delete s._container)},provide:function(e,n){return i.provides[e]=n,s},runWithContext:function(e){return console.log("Horizon中暂时不支持runWithContext，请手动修改相关的代码。"),e()}};return s.directive("show",a),d.set(o,s),s},exports.createAppContext=p,exports.defineAsyncComponent=function(t){var r=e.lazy(t);return function(t){return n.jsx(e.Suspense,{fallback:null,children:n.jsx(r,i({},t))})}},exports.defineEmits=function(e,n){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];x.apply(void 0,[n,e].concat(r))}},exports.defineExpose=function(e){var n=P();n?"object"==typeof e&&null!==e?Object.keys(e).forEach((function(t){n[t]=e[t]})):console.warn("defineExpose: Argument should be an object"):console.warn("defineExpose: No instance found. Make sure this is called inside a component setup function.")},exports.emit=x,exports.getCurrentInstance=g,exports.initProps=k,exports.inject=V,exports.onActivated=function(e){var n=V("onActivatedListeners"),t=V("keep-alive-key");return n.has(t)||n.set(t,new Set),n.get(t).add(e),function(){var n=V("onActivatedListeners"),t=V("keep-alive-key");n.get(t).delete(e)}},exports.onBeforeMount=function(e){o()||null==e||e()},exports.onBeforeUnmount=function(n){e.useLayoutEffect((function(){return function(){null==n||n()}}),[])},exports.onBeforeUpdate=function(n){e.useEffect((function(){null==n||n()}))},exports.onDeactivated=function(e){var n=V("onDeactivatedListeners"),t=V("keep-alive-key");return n.has(t)||n.set(t,new Set),n.get(t).add(e),function(){var n=V("onDeactivatedListeners"),t=V("keep-alive-key");n.get(t).delete(e)}},exports.onMounted=function(n){e.useEffect((function(){null==n||n()}),[])},exports.onUnmounted=function(n){e.useEffect((function(){return function(){null==n||n()}}),[])},exports.onUpdated=function(n){e.useEffect((function(){null==n||n()}))},exports.provide=L,exports.registerComponent=function(e,n){d.get("DEFAULT_APP_KEY").component(e,n)},exports.registerDirective=function(e,n){d.get("DEFAULT_APP_KEY").directive(e,n)},exports.setToInstance=function(e,n){return n&&"object"==typeof n&&!Array.isArray(n)?(Object.entries(n).forEach((function(n){var t=n[0],r=n[1];t?e[t]=r:console.warn("跳过没有键名的项:",r)})),e):(Array.isArray(n)?n.forEach((function(n){if(Array.isArray(n)){var t=n[0],r=n[1];t?e[t]=r:console.warn("跳过没有键名的数组项:",n)}else if("function"!=typeof n)console.warn("跳过无效的项:",n);else{var o=n.name;o?e[o]=n:console.warn("跳过未命名的函数")}})):console.warn("无效的 items 类型:",n),e)},exports.styles=N,exports.updateProps=U,exports.useActivatePro=Y,exports.useAttrs=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=i({},e);n.forEach((function(e){return delete t[e]}));var r=P();return r.$attrs=t,t},exports.useDirectives=h,exports.useGlobalProperties=function(n){var t=e.useContext(m);return n?t.config.globalProperties[n]:t.config.globalProperties},exports.useIsMounted=o,exports.useProvide=function(n){return e.useContext(m)._context.provides[n]},exports.useReactiveProps=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.useRef(null);return null===r.current?r.current=k(n,t):U(r.current,n,t),R(),r.current},exports.useSlots=function(e){var n={};return Object.entries(e).forEach((function(e){var t=e[0],r=e[1];if(t.startsWith("template_")){var o=t.replace("template_","");n[o]=r}})),e.children&&(n.default=e.children),n},exports.useUnActivatePro=X;
//# sourceMappingURL=vue-adapter.min.js.map
